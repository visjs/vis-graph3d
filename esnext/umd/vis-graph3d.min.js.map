{"version":3,"file":"vis-graph3d.min.js","sources":["../../lib/graph3d/Point3d.js","../../lib/graph3d/Point2d.js","../../lib/graph3d/Slider.js","../../lib/graph3d/StepNumber.js","../../lib/graph3d/Camera.js","../../lib/graph3d/Settings.js","../../lib/graph3d/options.js","../../lib/graph3d/Range.js","../../lib/graph3d/Filter.js","../../lib/graph3d/DataGroup.js","../../lib/graph3d/Graph3d.js"],"sourcesContent":["/**\n * @param {number} [x]\n * @param {number} [y]\n * @param {number} [z]\n */\nfunction Point3d(x, y, z) {\n  this.x = x !== undefined ? x : 0;\n  this.y = y !== undefined ? y : 0;\n  this.z = z !== undefined ? z : 0;\n}\n\n/**\n * Subtract the two provided points, returns a-b\n *\n * @param {Point3d} a\n * @param {Point3d} b\n * @returns {Point3d} a-b\n */\nPoint3d.subtract = function (a, b) {\n  const sub = new Point3d();\n  sub.x = a.x - b.x;\n  sub.y = a.y - b.y;\n  sub.z = a.z - b.z;\n  return sub;\n};\n\n/**\n * Add the two provided points, returns a+b\n *\n * @param {Point3d} a\n * @param {Point3d} b\n * @returns {Point3d} a+b\n */\nPoint3d.add = function (a, b) {\n  const sum = new Point3d();\n  sum.x = a.x + b.x;\n  sum.y = a.y + b.y;\n  sum.z = a.z + b.z;\n  return sum;\n};\n\n/**\n * Calculate the average of two 3d points\n *\n * @param {Point3d} a\n * @param {Point3d} b\n * @returns {Point3d} The average, (a+b)/2\n */\nPoint3d.avg = function (a, b) {\n  return new Point3d((a.x + b.x) / 2, (a.y + b.y) / 2, (a.z + b.z) / 2);\n};\n\n/**\n * Scale the provided point by a scalar, returns p*c\n *\n * @param {Point3d} p\n * @param {number} c\n * @returns {Point3d} p*c\n */\nPoint3d.scalarProduct = function (p, c) {\n  return new Point3d(p.x * c, p.y * c, p.z * c);\n};\n\n/**\n * Calculate the dot product of the two provided points, returns a.b\n * Documentation: http://en.wikipedia.org/wiki/Dot_product\n *\n * @param {Point3d} a\n * @param {Point3d} b\n * @returns {Point3d} dot product a.b\n */\nPoint3d.dotProduct = function (a, b) {\n  return a.x * b.x + a.y * b.y + a.z * b.z;\n};\n\n/**\n * Calculate the cross product of the two provided points, returns axb\n * Documentation: http://en.wikipedia.org/wiki/Cross_product\n *\n * @param {Point3d} a\n * @param {Point3d} b\n * @returns {Point3d} cross product axb\n */\nPoint3d.crossProduct = function (a, b) {\n  const crossproduct = new Point3d();\n\n  crossproduct.x = a.y * b.z - a.z * b.y;\n  crossproduct.y = a.z * b.x - a.x * b.z;\n  crossproduct.z = a.x * b.y - a.y * b.x;\n\n  return crossproduct;\n};\n\n/**\n * Retrieve the length of the vector (or the distance from this point to the origin\n *\n * @returns {number}  length\n */\nPoint3d.prototype.length = function () {\n  return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n};\n\n/**\n * Return a normalized vector pointing in the same direction.\n *\n * @returns {Point3d}  normalized\n */\nPoint3d.prototype.normalize = function () {\n  return Point3d.scalarProduct(this, 1 / this.length());\n};\n\nmodule.exports = Point3d;\n","/**\n * @param {number} [x]\n * @param {number} [y]\n */\nfunction Point2d(x, y) {\n  this.x = x !== undefined ? x : 0;\n  this.y = y !== undefined ? y : 0;\n}\n\nmodule.exports = Point2d;\n","import * as util from \"vis-util/esnext\";\n\n/**\n * An html slider control with start/stop/prev/next buttons\n *\n * @function Object() { [native code] } Slider\n * @param {Element} container  The element where the slider will be created\n * @param {object} options   Available options:\n *                 {boolean} visible   If true (default) the\n *                           slider is visible.\n */\nfunction Slider(container, options) {\n  if (container === undefined) {\n    throw new Error(\"No container element defined\");\n  }\n  this.container = container;\n  this.visible =\n    options && options.visible != undefined ? options.visible : true;\n\n  if (this.visible) {\n    this.frame = document.createElement(\"DIV\");\n    //this.frame.style.backgroundColor = '#E5E5E5';\n    this.frame.style.width = \"100%\";\n    this.frame.style.position = \"relative\";\n    this.container.appendChild(this.frame);\n\n    this.frame.prev = document.createElement(\"INPUT\");\n    this.frame.prev.type = \"BUTTON\";\n    this.frame.prev.value = \"Prev\";\n    this.frame.appendChild(this.frame.prev);\n\n    this.frame.play = document.createElement(\"INPUT\");\n    this.frame.play.type = \"BUTTON\";\n    this.frame.play.value = \"Play\";\n    this.frame.appendChild(this.frame.play);\n\n    this.frame.next = document.createElement(\"INPUT\");\n    this.frame.next.type = \"BUTTON\";\n    this.frame.next.value = \"Next\";\n    this.frame.appendChild(this.frame.next);\n\n    this.frame.bar = document.createElement(\"INPUT\");\n    this.frame.bar.type = \"BUTTON\";\n    this.frame.bar.style.position = \"absolute\";\n    this.frame.bar.style.border = \"1px solid red\";\n    this.frame.bar.style.width = \"100px\";\n    this.frame.bar.style.height = \"6px\";\n    this.frame.bar.style.borderRadius = \"2px\";\n    this.frame.bar.style.MozBorderRadius = \"2px\";\n    this.frame.bar.style.border = \"1px solid #7F7F7F\";\n    this.frame.bar.style.backgroundColor = \"#E5E5E5\";\n    this.frame.appendChild(this.frame.bar);\n\n    this.frame.slide = document.createElement(\"INPUT\");\n    this.frame.slide.type = \"BUTTON\";\n    this.frame.slide.style.margin = \"0px\";\n    this.frame.slide.value = \" \";\n    this.frame.slide.style.position = \"relative\";\n    this.frame.slide.style.left = \"-100px\";\n    this.frame.appendChild(this.frame.slide);\n\n    // create events\n    const me = this;\n    this.frame.slide.onmousedown = function (event) {\n      me._onMouseDown(event);\n    };\n    this.frame.prev.onclick = function (event) {\n      me.prev(event);\n    };\n    this.frame.play.onclick = function (event) {\n      me.togglePlay(event);\n    };\n    this.frame.next.onclick = function (event) {\n      me.next(event);\n    };\n  }\n\n  this.onChangeCallback = undefined;\n\n  this.values = [];\n  this.index = undefined;\n\n  this.playTimeout = undefined;\n  this.playInterval = 1000; // milliseconds\n  this.playLoop = true;\n}\n\n/**\n * Select the previous index\n */\nSlider.prototype.prev = function () {\n  let index = this.getIndex();\n  if (index > 0) {\n    index--;\n    this.setIndex(index);\n  }\n};\n\n/**\n * Select the next index\n */\nSlider.prototype.next = function () {\n  let index = this.getIndex();\n  if (index < this.values.length - 1) {\n    index++;\n    this.setIndex(index);\n  }\n};\n\n/**\n * Select the next index\n */\nSlider.prototype.playNext = function () {\n  const start = new Date();\n\n  let index = this.getIndex();\n  if (index < this.values.length - 1) {\n    index++;\n    this.setIndex(index);\n  } else if (this.playLoop) {\n    // jump to the start\n    index = 0;\n    this.setIndex(index);\n  }\n\n  const end = new Date();\n  const diff = end - start;\n\n  // calculate how much time it to to set the index and to execute the callback\n  // function.\n  const interval = Math.max(this.playInterval - diff, 0);\n  // document.title = diff // TODO: cleanup\n\n  const me = this;\n  this.playTimeout = setTimeout(function () {\n    me.playNext();\n  }, interval);\n};\n\n/**\n * Toggle start or stop playing\n */\nSlider.prototype.togglePlay = function () {\n  if (this.playTimeout === undefined) {\n    this.play();\n  } else {\n    this.stop();\n  }\n};\n\n/**\n * Start playing\n */\nSlider.prototype.play = function () {\n  // Test whether already playing\n  if (this.playTimeout) return;\n\n  this.playNext();\n\n  if (this.frame) {\n    this.frame.play.value = \"Stop\";\n  }\n};\n\n/**\n * Stop playing\n */\nSlider.prototype.stop = function () {\n  clearInterval(this.playTimeout);\n  this.playTimeout = undefined;\n\n  if (this.frame) {\n    this.frame.play.value = \"Play\";\n  }\n};\n\n/**\n * Set a callback function which will be triggered when the value of the\n * slider bar has changed.\n *\n * @param {Function} callback\n */\nSlider.prototype.setOnChangeCallback = function (callback) {\n  this.onChangeCallback = callback;\n};\n\n/**\n * Set the interval for playing the list\n *\n * @param {number} interval   The interval in milliseconds\n */\nSlider.prototype.setPlayInterval = function (interval) {\n  this.playInterval = interval;\n};\n\n/**\n * Retrieve the current play interval\n *\n * @returns {number} interval   The interval in milliseconds\n */\nSlider.prototype.getPlayInterval = function () {\n  return this.playInterval;\n};\n\n/**\n * Set looping on or off\n *\n * @param {boolean} doLoop  If true, the slider will jump to the start when\n *               the end is passed, and will jump to the end\n *               when the start is passed.\n */\nSlider.prototype.setPlayLoop = function (doLoop) {\n  this.playLoop = doLoop;\n};\n\n/**\n * Execute the onchange callback function\n */\nSlider.prototype.onChange = function () {\n  if (this.onChangeCallback !== undefined) {\n    this.onChangeCallback();\n  }\n};\n\n/**\n * redraw the slider on the correct place\n */\nSlider.prototype.redraw = function () {\n  if (this.frame) {\n    // resize the bar\n    this.frame.bar.style.top =\n      this.frame.clientHeight / 2 - this.frame.bar.offsetHeight / 2 + \"px\";\n    this.frame.bar.style.width =\n      this.frame.clientWidth -\n      this.frame.prev.clientWidth -\n      this.frame.play.clientWidth -\n      this.frame.next.clientWidth -\n      30 +\n      \"px\";\n\n    // position the slider button\n    const left = this.indexToLeft(this.index);\n    this.frame.slide.style.left = left + \"px\";\n  }\n};\n\n/**\n * Set the list with values for the slider\n *\n * @param {Array} values   A javascript array with values (any type)\n */\nSlider.prototype.setValues = function (values) {\n  this.values = values;\n\n  if (this.values.length > 0) this.setIndex(0);\n  else this.index = undefined;\n};\n\n/**\n * Select a value by its index\n *\n * @param {number} index\n */\nSlider.prototype.setIndex = function (index) {\n  if (index < this.values.length) {\n    this.index = index;\n\n    this.redraw();\n    this.onChange();\n  } else {\n    throw new Error(\"Index out of range\");\n  }\n};\n\n/**\n * retrieve the index of the currently selected vaue\n *\n * @returns {number} index\n */\nSlider.prototype.getIndex = function () {\n  return this.index;\n};\n\n/**\n * retrieve the currently selected value\n *\n * @returns {*} value\n */\nSlider.prototype.get = function () {\n  return this.values[this.index];\n};\n\nSlider.prototype._onMouseDown = function (event) {\n  // only react on left mouse button down\n  const leftButtonDown = event.which ? event.which === 1 : event.button === 1;\n  if (!leftButtonDown) return;\n\n  this.startClientX = event.clientX;\n  this.startSlideX = parseFloat(this.frame.slide.style.left);\n\n  this.frame.style.cursor = \"move\";\n\n  // add event listeners to handle moving the contents\n  // we store the function onmousemove and onmouseup in the graph, so we can\n  // remove the eventlisteners lateron in the function mouseUp()\n  const me = this;\n  this.onmousemove = function (event) {\n    me._onMouseMove(event);\n  };\n  this.onmouseup = function (event) {\n    me._onMouseUp(event);\n  };\n  document.addEventListener(\"mousemove\", this.onmousemove);\n  document.addEventListener(\"mouseup\", this.onmouseup);\n  util.preventDefault(event);\n};\n\nSlider.prototype.leftToIndex = function (left) {\n  const width =\n    parseFloat(this.frame.bar.style.width) - this.frame.slide.clientWidth - 10;\n  const x = left - 3;\n\n  let index = Math.round((x / width) * (this.values.length - 1));\n  if (index < 0) index = 0;\n  if (index > this.values.length - 1) index = this.values.length - 1;\n\n  return index;\n};\n\nSlider.prototype.indexToLeft = function (index) {\n  const width =\n    parseFloat(this.frame.bar.style.width) - this.frame.slide.clientWidth - 10;\n\n  const x = (index / (this.values.length - 1)) * width;\n  const left = x + 3;\n\n  return left;\n};\n\nSlider.prototype._onMouseMove = function (event) {\n  const diff = event.clientX - this.startClientX;\n  const x = this.startSlideX + diff;\n\n  const index = this.leftToIndex(x);\n\n  this.setIndex(index);\n\n  util.preventDefault();\n};\n\nSlider.prototype._onMouseUp = function () {\n   \n  this.frame.style.cursor = \"auto\";\n\n  // remove event listeners\n  util.removeEventListener(document, \"mousemove\", this.onmousemove);\n  util.removeEventListener(document, \"mouseup\", this.onmouseup);\n\n  util.preventDefault();\n};\n\nexport default Slider;\n","/**\n * The class StepNumber is an iterator for Numbers. You provide a start and end\n * value, and a best step size. StepNumber itself rounds to fixed values and\n * a finds the step that best fits the provided step.\n *\n * If prettyStep is true, the step size is chosen as close as possible to the\n * provided step, but being a round value like 1, 2, 5, 10, 20, 50, ....\n *\n * Example usage:\n *   var step = new StepNumber(0, 10, 2.5, true);\n *   step.start();\n *   while (!step.end()) {\n *   alert(step.getCurrent());\n *   step.next();\n *   }\n *\n * Version: 1.0\n * @param {number} start     The start value\n * @param {number} end     The end value\n * @param {number} step    Optional. Step size. Must be a positive value.\n * @param {boolean} prettyStep Optional. If true, the step size is rounded\n *               To a pretty step size (like 1, 2, 5, 10, 20, 50, ...)\n */\nfunction StepNumber(start, end, step, prettyStep) {\n  // set default values\n  this._start = 0;\n  this._end = 0;\n  this._step = 1;\n  this.prettyStep = true;\n  this.precision = 5;\n\n  this._current = 0;\n  this.setRange(start, end, step, prettyStep);\n}\n\n/**\n * Check for input values, to prevent disasters from happening\n *\n * Source: http://stackoverflow.com/a/1830844\n *\n * @param {string} n\n * @returns {boolean}\n */\nStepNumber.prototype.isNumeric = function (n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n};\n\n/**\n * Set a new range: start, end and step.\n *\n * @param {number} start     The start value\n * @param {number} end     The end value\n * @param {number} step    Optional. Step size. Must be a positive value.\n * @param {boolean} prettyStep Optional. If true, the step size is rounded\n *               To a pretty step size (like 1, 2, 5, 10, 20, 50, ...)\n */\nStepNumber.prototype.setRange = function (start, end, step, prettyStep) {\n  if (!this.isNumeric(start)) {\n    throw new Error(\"Parameter 'start' is not numeric; value: \" + start);\n  }\n  if (!this.isNumeric(end)) {\n    throw new Error(\"Parameter 'end' is not numeric; value: \" + start);\n  }\n  if (!this.isNumeric(step)) {\n    throw new Error(\"Parameter 'step' is not numeric; value: \" + start);\n  }\n\n  this._start = start ? start : 0;\n  this._end = end ? end : 0;\n\n  this.setStep(step, prettyStep);\n};\n\n/**\n * Set a new step size\n *\n * @param {number} step    New step size. Must be a positive value\n * @param {boolean} prettyStep Optional. If true, the provided step is rounded\n *               to a pretty step size (like 1, 2, 5, 10, 20, 50, ...)\n */\nStepNumber.prototype.setStep = function (step, prettyStep) {\n  if (step === undefined || step <= 0) return;\n\n  if (prettyStep !== undefined) this.prettyStep = prettyStep;\n\n  if (this.prettyStep === true)\n    this._step = StepNumber.calculatePrettyStep(step);\n  else this._step = step;\n};\n\n/**\n * Calculate a nice step size, closest to the desired step size.\n * Returns a value in one of the ranges 1*10^n, 2*10^n, or 5*10^n, where n is an\n * integer Number. For example 1, 2, 5, 10, 20, 50, etc...\n *\n * @param {number}  step  Desired step size\n * @returns {number}     Nice step size\n */\nStepNumber.calculatePrettyStep = function (step) {\n  const log10 = function (x) {\n    return Math.log(x) / Math.LN10;\n  };\n\n  // try three steps (multiple of 1, 2, or 5\n  const step1 = Math.pow(10, Math.round(log10(step))),\n    step2 = 2 * Math.pow(10, Math.round(log10(step / 2))),\n    step5 = 5 * Math.pow(10, Math.round(log10(step / 5)));\n\n  // choose the best step (closest to minimum step)\n  let prettyStep = step1;\n  if (Math.abs(step2 - step) <= Math.abs(prettyStep - step)) prettyStep = step2;\n  if (Math.abs(step5 - step) <= Math.abs(prettyStep - step)) prettyStep = step5;\n\n  // for safety\n  if (prettyStep <= 0) {\n    prettyStep = 1;\n  }\n\n  return prettyStep;\n};\n\n/**\n * returns the current value of the step\n *\n * @returns {number} current value\n */\nStepNumber.prototype.getCurrent = function () {\n  return parseFloat(this._current.toPrecision(this.precision));\n};\n\n/**\n * returns the current step size\n *\n * @returns {number} current step size\n */\nStepNumber.prototype.getStep = function () {\n  return this._step;\n};\n\n/**\n * Set the current to its starting value.\n *\n * By default, this will be the largest value smaller than start, which\n * is a multiple of the step size.\n *\n * Parameters checkFirst is optional, default false.\n * If set to true, move the current value one step if smaller than start.\n *\n * @param {boolean} [checkFirst=false]\n */\nStepNumber.prototype.start = function (checkFirst) {\n  if (checkFirst === undefined) {\n    checkFirst = false;\n  }\n\n  this._current = this._start - (this._start % this._step);\n\n  if (checkFirst) {\n    if (this.getCurrent() < this._start) {\n      this.next();\n    }\n  }\n};\n\n/**\n * Do a step, add the step size to the current value\n */\nStepNumber.prototype.next = function () {\n  this._current += this._step;\n};\n\n/**\n * Returns true whether the end is reached\n *\n * @returns {boolean}  True if the current value has passed the end value.\n */\nStepNumber.prototype.end = function () {\n  return this._current > this._end;\n};\n\nmodule.exports = StepNumber;\n","import Point3d from \"./Point3d\";\n\n/**\n * The camera is mounted on a (virtual) camera arm. The camera arm can rotate\n * The camera is always looking in the direction of the origin of the arm.\n * This way, the camera always rotates around one fixed point, the location\n * of the camera arm.\n *\n * Documentation:\n *   http://en.wikipedia.org/wiki/3D_projection\n *\n * @class Camera\n */\nfunction Camera() {\n  this.armLocation = new Point3d();\n  this.armRotation = {};\n  this.armRotation.horizontal = 0;\n  this.armRotation.vertical = 0;\n  this.armLength = 1.7;\n  this.cameraOffset = new Point3d();\n  this.offsetMultiplier = 0.6;\n\n  this.cameraLocation = new Point3d();\n  this.cameraRotation = new Point3d(0.5 * Math.PI, 0, 0);\n\n  this.calculateCameraOrientation();\n}\n\n/**\n * Set offset camera in camera coordinates\n *\n * @param {number} x offset by camera horisontal\n * @param {number} y offset by camera vertical\n */\nCamera.prototype.setOffset = function (x, y) {\n  const abs = Math.abs,\n    sign = Math.sign,\n    mul = this.offsetMultiplier,\n    border = this.armLength * mul;\n\n  if (abs(x) > border) {\n    x = sign(x) * border;\n  }\n  if (abs(y) > border) {\n    y = sign(y) * border;\n  }\n  this.cameraOffset.x = x;\n  this.cameraOffset.y = y;\n  this.calculateCameraOrientation();\n};\n\n/**\n * Get camera offset by horizontal and vertical\n *\n * @returns {number}\n */\nCamera.prototype.getOffset = function () {\n  return this.cameraOffset;\n};\n\n/**\n * Set the location (origin) of the arm\n *\n * @param {number} x  Normalized value of x\n * @param {number} y  Normalized value of y\n * @param {number} z  Normalized value of z\n */\nCamera.prototype.setArmLocation = function (x, y, z) {\n  this.armLocation.x = x;\n  this.armLocation.y = y;\n  this.armLocation.z = z;\n\n  this.calculateCameraOrientation();\n};\n\n/**\n * Set the rotation of the camera arm\n *\n * @param {number} horizontal   The horizontal rotation, between 0 and 2*PI.\n *                Optional, can be left undefined.\n * @param {number} vertical   The vertical rotation, between 0 and 0.5*PI\n *                if vertical=0.5*PI, the graph is shown from the\n *                top. Optional, can be left undefined.\n */\nCamera.prototype.setArmRotation = function (horizontal, vertical) {\n  if (horizontal !== undefined) {\n    this.armRotation.horizontal = horizontal;\n  }\n\n  if (vertical !== undefined) {\n    this.armRotation.vertical = vertical;\n    if (this.armRotation.vertical < 0) this.armRotation.vertical = 0;\n    if (this.armRotation.vertical > 0.5 * Math.PI)\n      this.armRotation.vertical = 0.5 * Math.PI;\n  }\n\n  if (horizontal !== undefined || vertical !== undefined) {\n    this.calculateCameraOrientation();\n  }\n};\n\n/**\n * Retrieve the current arm rotation\n *\n * @returns {object}   An object with parameters horizontal and vertical\n */\nCamera.prototype.getArmRotation = function () {\n  const rot = {};\n  rot.horizontal = this.armRotation.horizontal;\n  rot.vertical = this.armRotation.vertical;\n\n  return rot;\n};\n\n/**\n * Set the (normalized) length of the camera arm.\n *\n * @param {number} length A length between 0.71 and 5.0\n */\nCamera.prototype.setArmLength = function (length) {\n  if (length === undefined) return;\n\n  this.armLength = length;\n\n  // Radius must be larger than the corner of the graph,\n  // which has a distance of sqrt(0.5^2+0.5^2) = 0.71 from the center of the\n  // graph\n  if (this.armLength < 0.71) this.armLength = 0.71;\n  if (this.armLength > 5.0) this.armLength = 5.0;\n\n  this.setOffset(this.cameraOffset.x, this.cameraOffset.y);\n  this.calculateCameraOrientation();\n};\n\n/**\n * Retrieve the arm length\n *\n * @returns {number} length\n */\nCamera.prototype.getArmLength = function () {\n  return this.armLength;\n};\n\n/**\n * Retrieve the camera location\n *\n * @returns {Point3d} cameraLocation\n */\nCamera.prototype.getCameraLocation = function () {\n  return this.cameraLocation;\n};\n\n/**\n * Retrieve the camera rotation\n *\n * @returns {Point3d} cameraRotation\n */\nCamera.prototype.getCameraRotation = function () {\n  return this.cameraRotation;\n};\n\n/**\n * Calculate the location and rotation of the camera based on the\n * position and orientation of the camera arm\n */\nCamera.prototype.calculateCameraOrientation = function () {\n  // calculate location of the camera\n  this.cameraLocation.x =\n    this.armLocation.x -\n    this.armLength *\n      Math.sin(this.armRotation.horizontal) *\n      Math.cos(this.armRotation.vertical);\n  this.cameraLocation.y =\n    this.armLocation.y -\n    this.armLength *\n      Math.cos(this.armRotation.horizontal) *\n      Math.cos(this.armRotation.vertical);\n  this.cameraLocation.z =\n    this.armLocation.z + this.armLength * Math.sin(this.armRotation.vertical);\n\n  // calculate rotation of the camera\n  this.cameraRotation.x = Math.PI / 2 - this.armRotation.vertical;\n  this.cameraRotation.y = 0;\n  this.cameraRotation.z = -this.armRotation.horizontal;\n\n  const xa = this.cameraRotation.x;\n  const za = this.cameraRotation.z;\n  const dx = this.cameraOffset.x;\n  const dy = this.cameraOffset.y;\n  const sin = Math.sin,\n    cos = Math.cos;\n\n  this.cameraLocation.x =\n    this.cameraLocation.x + dx * cos(za) + dy * -sin(za) * cos(xa);\n  this.cameraLocation.y =\n    this.cameraLocation.y + dx * sin(za) + dy * cos(za) * cos(xa);\n  this.cameraLocation.z = this.cameraLocation.z + dy * sin(xa);\n};\n\nexport default Camera;\n","////////////////////////////////////////////////////////////////////////////////\n// This modules handles the options for Graph3d.\n//\n////////////////////////////////////////////////////////////////////////////////\nimport * as util from \"vis-util/esnext\";\nimport Camera from \"./Camera\";\nimport Point3d from \"./Point3d\";\n\n// enumerate the available styles\nconst STYLE = {\n  BAR: 0,\n  BARCOLOR: 1,\n  BARSIZE: 2,\n  DOT: 3,\n  DOTLINE: 4,\n  DOTCOLOR: 5,\n  DOTSIZE: 6,\n  GRID: 7,\n  LINE: 8,\n  SURFACE: 9,\n};\n\n// The string representations of the styles\nconst STYLENAME = {\n  dot: STYLE.DOT,\n  \"dot-line\": STYLE.DOTLINE,\n  \"dot-color\": STYLE.DOTCOLOR,\n  \"dot-size\": STYLE.DOTSIZE,\n  line: STYLE.LINE,\n  grid: STYLE.GRID,\n  surface: STYLE.SURFACE,\n  bar: STYLE.BAR,\n  \"bar-color\": STYLE.BARCOLOR,\n  \"bar-size\": STYLE.BARSIZE,\n};\n\n/**\n * Field names in the options hash which are of relevance to the user.\n *\n * Specifically, these are the fields which require no special handling,\n * and can be directly copied over.\n */\nconst OPTIONKEYS = [\n  \"width\",\n  \"height\",\n  \"filterLabel\",\n  \"legendLabel\",\n  \"xLabel\",\n  \"yLabel\",\n  \"zLabel\",\n  \"xValueLabel\",\n  \"yValueLabel\",\n  \"zValueLabel\",\n  \"showXAxis\",\n  \"showYAxis\",\n  \"showZAxis\",\n  \"showGrayBottom\",\n  \"showGrid\",\n  \"showPerspective\",\n  \"showShadow\",\n  \"showSurfaceGrid\",\n  \"keepAspectRatio\",\n  \"rotateAxisLabels\",\n  \"verticalRatio\",\n  \"dotSizeRatio\",\n  \"dotSizeMinFraction\",\n  \"dotSizeMaxFraction\",\n  \"showAnimationControls\",\n  \"animationInterval\",\n  \"animationPreload\",\n  \"animationAutoStart\",\n  \"axisColor\",\n  \"axisFontSize\",\n  \"axisFontType\",\n  \"gridColor\",\n  \"xCenter\",\n  \"yCenter\",\n  \"zoomable\",\n  \"tooltipDelay\",\n  \"ctrlToZoom\",\n];\n\n/**\n * Field names in the options hash which are of relevance to the user.\n *\n * Same as OPTIONKEYS, but internally these fields are stored with\n * prefix 'default' in the name.\n */\nconst PREFIXEDOPTIONKEYS = [\n  \"xBarWidth\",\n  \"yBarWidth\",\n  \"valueMin\",\n  \"valueMax\",\n  \"xMin\",\n  \"xMax\",\n  \"xStep\",\n  \"yMin\",\n  \"yMax\",\n  \"yStep\",\n  \"zMin\",\n  \"zMax\",\n  \"zStep\",\n];\n\n// Placeholder for DEFAULTS reference\nlet DEFAULTS = undefined;\n\n/**\n * Check if given hash is empty.\n *\n * Source: http://stackoverflow.com/a/679937\n *\n * @param {object} obj\n * @returns {boolean}\n */\nfunction isEmpty(obj) {\n  for (const prop in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, prop)) return false;\n  }\n\n  return true;\n}\n\n/**\n * Make first letter of parameter upper case.\n *\n * Source: http://stackoverflow.com/a/1026087\n *\n * @param {string} str\n * @returns {string}\n */\nfunction capitalize(str) {\n  if (str === undefined || str === \"\" || typeof str != \"string\") {\n    return str;\n  }\n\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Add a prefix to a field name, taking style guide into account\n *\n * @param {string} prefix\n * @param {string} fieldName\n * @returns {string}\n */\nfunction prefixFieldName(prefix, fieldName) {\n  if (prefix === undefined || prefix === \"\") {\n    return fieldName;\n  }\n\n  return prefix + capitalize(fieldName);\n}\n\n/**\n * Forcibly copy fields from src to dst in a controlled manner.\n *\n * A given field in dst will always be overwitten. If this field\n * is undefined or not present in src, the field in dst will\n * be explicitly set to undefined.\n *\n * The intention here is to be able to reset all option fields.\n *\n * Only the fields mentioned in array 'fields' will be handled.\n *\n * @param {object} src\n * @param {object} dst\n * @param {Array<string>} fields array with names of fields to copy\n * @param {string} [prefix] prefix to use for the target fields.\n */\nfunction forceCopy(src, dst, fields, prefix) {\n  let srcKey;\n  let dstKey;\n\n  for (let i = 0; i < fields.length; ++i) {\n    srcKey = fields[i];\n    dstKey = prefixFieldName(prefix, srcKey);\n\n    dst[dstKey] = src[srcKey];\n  }\n}\n\n/**\n * Copy fields from src to dst in a safe and controlled manner.\n *\n * Only the fields mentioned in array 'fields' will be copied over,\n * and only if these are actually defined.\n *\n * @param {object} src\n * @param {object} dst\n * @param {Array<string>} fields array with names of fields to copy\n * @param {string} [prefix] prefix to use for the target fields.\n */\nfunction safeCopy(src, dst, fields, prefix) {\n  let srcKey;\n  let dstKey;\n\n  for (let i = 0; i < fields.length; ++i) {\n    srcKey = fields[i];\n    if (src[srcKey] === undefined) continue;\n\n    dstKey = prefixFieldName(prefix, srcKey);\n\n    dst[dstKey] = src[srcKey];\n  }\n}\n\n/**\n * Initialize dst with the values in src.\n *\n * src is the hash with the default values.\n * A reference DEFAULTS to this hash is stored locally for\n * further handling.\n *\n * For now, dst is assumed to be a Graph3d instance.\n *\n * @param {object} src\n * @param {object} dst\n */\nfunction setDefaults(src, dst) {\n  if (src === undefined || isEmpty(src)) {\n    throw new Error(\"No DEFAULTS passed\");\n  }\n  if (dst === undefined) {\n    throw new Error(\"No dst passed\");\n  }\n\n  // Remember defaults for future reference\n  DEFAULTS = src;\n\n  // Handle the defaults which can be simply copied over\n  forceCopy(src, dst, OPTIONKEYS);\n  forceCopy(src, dst, PREFIXEDOPTIONKEYS, \"default\");\n\n  // Handle the more complex ('special') fields\n  setSpecialSettings(src, dst);\n\n  // Following are internal fields, not part of the user settings\n  dst.margin = 10; // px\n  dst.showTooltip = false;\n  dst.onclick_callback = null;\n  dst.eye = new Point3d(0, 0, -1); // TODO: set eye.z about 3/4 of the width of the window?\n}\n\n/**\n *\n * @param {object} options\n * @param {object} dst\n */\nfunction setOptions(options, dst) {\n  if (options === undefined) {\n    return;\n  }\n  if (dst === undefined) {\n    throw new Error(\"No dst passed\");\n  }\n\n  if (DEFAULTS === undefined || isEmpty(DEFAULTS)) {\n    throw new Error(\"DEFAULTS not set for module Settings\");\n  }\n\n  // Handle the parameters which can be simply copied over\n  safeCopy(options, dst, OPTIONKEYS);\n  safeCopy(options, dst, PREFIXEDOPTIONKEYS, \"default\");\n\n  // Handle the more complex ('special') fields\n  setSpecialSettings(options, dst);\n}\n\n/**\n * Special handling for certain parameters\n *\n * 'Special' here means: setting requires more than a simple copy\n *\n * @param {object} src\n * @param {object} dst\n */\nfunction setSpecialSettings(src, dst) {\n  if (src.backgroundColor !== undefined) {\n    setBackgroundColor(src.backgroundColor, dst);\n  }\n\n  setDataColor(src.dataColor, dst);\n  setStyle(src.style, dst);\n  if (src.surfaceColors !== undefined) {\n    console.warn(\n      \"`options.surfaceColors` is deprecated and may be removed in a future \" +\n        \"version. Please use `options.colormap` instead. Note that the `colormap` \" +\n        \"option uses the inverse array ordering (running from vMin to vMax).\"\n    );\n    if (src.colormap !== undefined) {\n      throw new Error(\n        \"The `colormap` and `surfaceColors` options are mutually exclusive.\"\n      );\n    }\n    if (dst.style !== \"surface\") {\n      console.warn(\n        \"Ignoring `surfaceColors` in graph style `\" +\n          dst.style +\n          \"` for \" +\n          \"backward compatibility (only effective in `surface` plots).\"\n      );\n    } else {\n      setSurfaceColor(src.surfaceColors, dst);\n    }\n  } else {\n    setColormap(src.colormap, dst);\n  }\n  setShowLegend(src.showLegend, dst);\n  setCameraPosition(src.cameraPosition, dst);\n\n  // As special fields go, this is an easy one; just a translation of the name.\n  // Can't use this.tooltip directly, because that field exists internally\n  if (src.tooltip !== undefined) {\n    dst.showTooltip = src.tooltip;\n  }\n  if (src.onclick != undefined) {\n    dst.onclick_callback = src.onclick;\n    console.warn(\n      \"`options.onclick` is deprecated and may be removed in a future version.\" +\n        \" Please use `Graph3d.on('click', handler)` instead.\"\n    );\n  }\n\n  if (src.tooltipStyle !== undefined) {\n    util.selectiveDeepExtend([\"tooltipStyle\"], dst, src);\n  }\n}\n\n/**\n * Set the value of setting 'showLegend'\n *\n * This depends on the value of the style fields, so it must be called\n * after the style field has been initialized.\n *\n * @param {boolean} showLegend\n * @param {object} dst\n */\nfunction setShowLegend(showLegend, dst) {\n  if (showLegend === undefined) {\n    // If the default was auto, make a choice for this field\n    const isAutoByDefault = DEFAULTS.showLegend === undefined;\n\n    if (isAutoByDefault) {\n      // these styles default to having legends\n      const isLegendGraphStyle =\n        dst.style === STYLE.DOTCOLOR || dst.style === STYLE.DOTSIZE;\n\n      dst.showLegend = isLegendGraphStyle;\n    } else {\n      // Leave current value as is\n    }\n  } else {\n    dst.showLegend = showLegend;\n  }\n}\n\n/**\n * Retrieve the style index from given styleName\n *\n * @param {string} styleName  Style name such as 'dot', 'grid', 'dot-line'\n * @returns {number} styleNumber Enumeration value representing the style, or -1\n *                when not found\n */\nfunction getStyleNumberByName(styleName) {\n  const number = STYLENAME[styleName];\n\n  if (number === undefined) {\n    return -1;\n  }\n\n  return number;\n}\n\n/**\n * Check if given number is a valid style number.\n *\n * @param {string | number} style\n * @returns {boolean} true if valid, false otherwise\n */\nfunction checkStyleNumber(style) {\n  let valid = false;\n\n  for (const n in STYLE) {\n    if (STYLE[n] === style) {\n      valid = true;\n      break;\n    }\n  }\n\n  return valid;\n}\n\n/**\n *\n * @param {string | number} style\n * @param {object} dst\n */\nfunction setStyle(style, dst) {\n  if (style === undefined) {\n    return; // Nothing to do\n  }\n\n  let styleNumber;\n\n  if (typeof style === \"string\") {\n    styleNumber = getStyleNumberByName(style);\n\n    if (styleNumber === -1) {\n      throw new Error(\"Style '\" + style + \"' is invalid\");\n    }\n  } else {\n    // Do a pedantic check on style number value\n    if (!checkStyleNumber(style)) {\n      throw new Error(\"Style '\" + style + \"' is invalid\");\n    }\n\n    styleNumber = style;\n  }\n\n  dst.style = styleNumber;\n}\n\n/**\n * Set the background styling for the graph\n *\n * @param {string | {fill: string, stroke: string, strokeWidth: string}} backgroundColor\n * @param {object} dst\n */\nfunction setBackgroundColor(backgroundColor, dst) {\n  let fill = \"white\";\n  let stroke = \"gray\";\n  let strokeWidth = 1;\n\n  if (typeof backgroundColor === \"string\") {\n    fill = backgroundColor;\n    stroke = \"none\";\n    strokeWidth = 0;\n  } else if (typeof backgroundColor === \"object\") {\n    if (backgroundColor.fill !== undefined) fill = backgroundColor.fill;\n    if (backgroundColor.stroke !== undefined) stroke = backgroundColor.stroke;\n    if (backgroundColor.strokeWidth !== undefined)\n      strokeWidth = backgroundColor.strokeWidth;\n  } else {\n    throw new Error(\"Unsupported type of backgroundColor\");\n  }\n\n  dst.frame.style.backgroundColor = fill;\n  dst.frame.style.borderColor = stroke;\n  dst.frame.style.borderWidth = strokeWidth + \"px\";\n  dst.frame.style.borderStyle = \"solid\";\n}\n\n/**\n *\n * @param {string | object} dataColor\n * @param {object} dst\n */\nfunction setDataColor(dataColor, dst) {\n  if (dataColor === undefined) {\n    return; // Nothing to do\n  }\n\n  if (dst.dataColor === undefined) {\n    dst.dataColor = {};\n  }\n\n  if (typeof dataColor === \"string\") {\n    dst.dataColor.fill = dataColor;\n    dst.dataColor.stroke = dataColor;\n  } else {\n    if (dataColor.fill) {\n      dst.dataColor.fill = dataColor.fill;\n    }\n    if (dataColor.stroke) {\n      dst.dataColor.stroke = dataColor.stroke;\n    }\n    if (dataColor.strokeWidth !== undefined) {\n      dst.dataColor.strokeWidth = dataColor.strokeWidth;\n    }\n  }\n}\n\n/**\n *\n * @param {object | Array<string>} surfaceColors Either an object that describes the HUE, or an array of HTML hex color codes\n * @param {object} dst\n */\nfunction setSurfaceColor(surfaceColors, dst) {\n  if (surfaceColors === undefined || surfaceColors === true) {\n    return; // Nothing to do\n  }\n  if (surfaceColors === false) {\n    dst.surfaceColors = undefined;\n    return;\n  }\n\n  if (dst.surfaceColors === undefined) {\n    dst.surfaceColors = {};\n  }\n\n  let rgbColors;\n  if (Array.isArray(surfaceColors)) {\n    rgbColors = parseColorArray(surfaceColors);\n  } else if (typeof surfaceColors === \"object\") {\n    rgbColors = parseColorObject(surfaceColors.hue);\n  } else {\n    throw new Error(\"Unsupported type of surfaceColors\");\n  }\n  // for some reason surfaceColors goes from vMax to vMin:\n  rgbColors.reverse();\n  dst.colormap = rgbColors;\n}\n\n/**\n *\n * @param {object | Array<string>} colormap Either an object that describes the HUE, or an array of HTML hex color codes\n * @param {object} dst\n */\nfunction setColormap(colormap, dst) {\n  if (colormap === undefined) {\n    return;\n  }\n\n  let rgbColors;\n  if (Array.isArray(colormap)) {\n    rgbColors = parseColorArray(colormap);\n  } else if (typeof colormap === \"object\") {\n    rgbColors = parseColorObject(colormap.hue);\n  } else if (typeof colormap === \"function\") {\n    rgbColors = colormap;\n  } else {\n    throw new Error(\"Unsupported type of colormap\");\n  }\n  dst.colormap = rgbColors;\n}\n\n/**\n *\n * @param {Array} colormap\n */\nfunction parseColorArray(colormap) {\n  if (colormap.length < 2) {\n    throw new Error(\"Colormap array length must be 2 or above.\");\n  }\n  return colormap.map(function (colorCode) {\n    if (!util.isValidHex(colorCode)) {\n      throw new Error(`Invalid hex color code supplied to colormap.`);\n    }\n    return util.hexToRGB(colorCode);\n  });\n}\n\n/**\n * Converts an object to a certain amount of hex color stops. At which point:\n * the HTML hex color codes is converted into an RGB color object.\n *\n * @param {object} hues\n */\nfunction parseColorObject(hues) {\n  if (hues === undefined) {\n    throw new Error(\"Unsupported type of colormap\");\n  }\n  if (!(hues.saturation >= 0 && hues.saturation <= 100)) {\n    throw new Error(\"Saturation is out of bounds. Expected range is 0-100.\");\n  }\n  if (!(hues.brightness >= 0 && hues.brightness <= 100)) {\n    throw new Error(\"Brightness is out of bounds. Expected range is 0-100.\");\n  }\n  if (!(hues.colorStops >= 2)) {\n    throw new Error(\"colorStops is out of bounds. Expected 2 or above.\");\n  }\n\n  const hueStep = (hues.end - hues.start) / (hues.colorStops - 1);\n\n  const rgbColors = [];\n  for (let i = 0; i < hues.colorStops; ++i) {\n    const hue = ((hues.start + hueStep * i) % 360) / 360;\n    rgbColors.push(\n      util.HSVToRGB(\n        hue < 0 ? hue + 1 : hue,\n        hues.saturation / 100,\n        hues.brightness / 100\n      )\n    );\n  }\n  return rgbColors;\n}\n\n/**\n *\n * @param {object} cameraPosition\n * @param {object} dst\n */\nfunction setCameraPosition(cameraPosition, dst) {\n  const camPos = cameraPosition;\n  if (camPos === undefined) {\n    return;\n  }\n\n  if (dst.camera === undefined) {\n    dst.camera = new Camera();\n  }\n\n  dst.camera.setArmRotation(camPos.horizontal, camPos.vertical);\n  dst.camera.setArmLength(camPos.distance);\n}\n\nexport { STYLE, setCameraPosition, setDefaults, setOptions };\n","/**\n * This object contains all possible options. It will check if the types are correct, if required if the option is one\n * of the allowed values.\n *\n * __any__ means that the name of the property does not matter.\n * __type__ is a required field for all objects and contains the allowed types of all objects\n */\nconst string = \"string\";\nconst bool = \"boolean\";\nconst number = \"number\";\nconst object = \"object\"; // should only be in a __type__ property\nconst array = \"array\";\n// Following not used here, but useful for reference\n//let dom      = 'dom';\n//let any      = 'any';\n\nconst colorOptions = {\n  fill: { string },\n  stroke: { string },\n  strokeWidth: { number },\n  __type__: { string, object, undefined: \"undefined\" },\n};\n\nconst surfaceColorsOptions = {\n  hue: {\n    start: { number },\n    end: { number },\n    saturation: { number },\n    brightness: { number },\n    colorStops: { number },\n    __type__: { object },\n  },\n  __type__: { boolean: bool, array, object, undefined: \"undefined\" },\n};\n\nconst colormapOptions = {\n  hue: {\n    start: { number },\n    end: { number },\n    saturation: { number },\n    brightness: { number },\n    colorStops: { number },\n    __type__: { object },\n  },\n  __type__: { array, object, function: \"function\", undefined: \"undefined\" },\n};\n\n/**\n * Order attempted to be alphabetical.\n *   - x/y/z-prefixes ignored in sorting\n *   - __type__ always at end\n *   - globals at end\n */\nconst allOptions = {\n  animationAutoStart: { boolean: bool, undefined: \"undefined\" },\n  animationInterval: { number },\n  animationPreload: { boolean: bool },\n  axisColor: { string },\n  axisFontSize: { number: number },\n  axisFontType: { string: string },\n  backgroundColor: colorOptions,\n  xBarWidth: { number, undefined: \"undefined\" },\n  yBarWidth: { number, undefined: \"undefined\" },\n  cameraPosition: {\n    distance: { number },\n    horizontal: { number },\n    vertical: { number },\n    __type__: { object },\n  },\n  zoomable: { boolean: bool },\n  ctrlToZoom: { boolean: bool },\n  xCenter: { string },\n  yCenter: { string },\n  colormap: colormapOptions,\n  dataColor: colorOptions,\n  dotSizeMinFraction: { number },\n  dotSizeMaxFraction: { number },\n  dotSizeRatio: { number },\n  filterLabel: { string },\n  gridColor: { string },\n  onclick: { function: \"function\" },\n  keepAspectRatio: { boolean: bool },\n  xLabel: { string },\n  yLabel: { string },\n  zLabel: { string },\n  legendLabel: { string },\n  xMin: { number, undefined: \"undefined\" },\n  yMin: { number, undefined: \"undefined\" },\n  zMin: { number, undefined: \"undefined\" },\n  xMax: { number, undefined: \"undefined\" },\n  yMax: { number, undefined: \"undefined\" },\n  zMax: { number, undefined: \"undefined\" },\n  showAnimationControls: { boolean: bool, undefined: \"undefined\" },\n  showGrayBottom: { boolean: bool },\n  showGrid: { boolean: bool },\n  showLegend: { boolean: bool, undefined: \"undefined\" },\n  showPerspective: { boolean: bool },\n  showShadow: { boolean: bool },\n  showSurfaceGrid: { boolean: bool },\n  showXAxis: { boolean: bool },\n  showYAxis: { boolean: bool },\n  showZAxis: { boolean: bool },\n  rotateAxisLabels: { boolean: bool },\n  surfaceColors: surfaceColorsOptions,\n  xStep: { number, undefined: \"undefined\" },\n  yStep: { number, undefined: \"undefined\" },\n  zStep: { number, undefined: \"undefined\" },\n  style: {\n    number, // TODO: either Graph3d.DEFAULT has string, or number allowed in documentation\n    string: [\n      \"bar\",\n      \"bar-color\",\n      \"bar-size\",\n      \"dot\",\n      \"dot-line\",\n      \"dot-color\",\n      \"dot-size\",\n      \"line\",\n      \"grid\",\n      \"surface\",\n    ],\n  },\n  tooltip: { boolean: bool, function: \"function\" },\n  tooltipDelay: { number: number },\n  tooltipStyle: {\n    content: {\n      color: { string },\n      background: { string },\n      border: { string },\n      borderRadius: { string },\n      boxShadow: { string },\n      padding: { string },\n      __type__: { object },\n    },\n    line: {\n      borderLeft: { string },\n      height: { string },\n      width: { string },\n      pointerEvents: { string },\n      __type__: { object },\n    },\n    dot: {\n      border: { string },\n      borderRadius: { string },\n      height: { string },\n      width: { string },\n      pointerEvents: { string },\n      __type__: { object },\n    },\n    __type__: { object },\n  },\n  xValueLabel: { function: \"function\" },\n  yValueLabel: { function: \"function\" },\n  zValueLabel: { function: \"function\" },\n  valueMax: { number, undefined: \"undefined\" },\n  valueMin: { number, undefined: \"undefined\" },\n  verticalRatio: { number },\n\n  //globals :\n  height: { string },\n  width: { string },\n  __type__: { object },\n};\n\nexport { allOptions };\n","/**\n * Helper class to make working with related min and max values easier.\n *\n * The range is inclusive; a given value is considered part of the range if:\n *\n *    this.min <= value <= this.max\n */\nfunction Range() {\n  this.min = undefined;\n  this.max = undefined;\n}\n\n/**\n * Adjust the range so that the passed value fits in it.\n *\n * If the value is outside of the current extremes, adjust\n * the min or max so that the value is within the range.\n *\n * @param {number} value Numeric value to fit in range\n */\nRange.prototype.adjust = function (value) {\n  if (value === undefined) return;\n\n  if (this.min === undefined || this.min > value) {\n    this.min = value;\n  }\n\n  if (this.max === undefined || this.max < value) {\n    this.max = value;\n  }\n};\n\n/**\n * Adjust the current range so that the passed range fits in it.\n *\n * @param {Range} range Range instance to fit in current instance\n */\nRange.prototype.combine = function (range) {\n  this.add(range.min);\n  this.add(range.max);\n};\n\n/**\n * Expand the range by the given value\n *\n * min will be lowered by given value;\n * max will be raised by given value\n *\n * Shrinking by passing a negative value is allowed.\n *\n * @param {number} val Amount by which to expand or shrink current range with\n */\nRange.prototype.expand = function (val) {\n  if (val === undefined) {\n    return;\n  }\n\n  const newMin = this.min - val;\n  const newMax = this.max + val;\n\n  // Note that following allows newMin === newMax.\n  // This should be OK, since method expand() allows this also.\n  if (newMin > newMax) {\n    throw new Error(\"Passed expansion value makes range invalid\");\n  }\n\n  this.min = newMin;\n  this.max = newMax;\n};\n\n/**\n * Determine the full range width of current instance.\n *\n * @returns {num} The calculated width of this range\n */\nRange.prototype.range = function () {\n  return this.max - this.min;\n};\n\n/**\n * Determine the central point of current instance.\n *\n * @returns {number} the value in the middle of min and max\n */\nRange.prototype.center = function () {\n  return (this.min + this.max) / 2;\n};\n\nmodule.exports = Range;\n","import { DataView } from \"vis-data/esnext\";\n\n/**\n * @class Filter\n * @param {DataGroup} dataGroup the data group\n * @param {number}  column             The index of the column to be filtered\n * @param {Graph3d} graph              The graph\n */\nfunction Filter(dataGroup, column, graph) {\n  this.dataGroup = dataGroup;\n  this.column = column;\n  this.graph = graph; // the parent graph\n\n  this.index = undefined;\n  this.value = undefined;\n\n  // read all distinct values and select the first one\n  this.values = dataGroup.getDistinctValues(this.column);\n\n  if (this.values.length > 0) {\n    this.selectValue(0);\n  }\n\n  // create an array with the filtered datapoints. this will be loaded afterwards\n  this.dataPoints = [];\n\n  this.loaded = false;\n  this.onLoadCallback = undefined;\n\n  if (graph.animationPreload) {\n    this.loaded = false;\n    this.loadInBackground();\n  } else {\n    this.loaded = true;\n  }\n}\n\n/**\n * Return the label\n *\n * @returns {string} label\n */\nFilter.prototype.isLoaded = function () {\n  return this.loaded;\n};\n\n/**\n * Return the loaded progress\n *\n * @returns {number} percentage between 0 and 100\n */\nFilter.prototype.getLoadedProgress = function () {\n  const len = this.values.length;\n\n  let i = 0;\n  while (this.dataPoints[i]) {\n    i++;\n  }\n\n  return Math.round((i / len) * 100);\n};\n\n/**\n * Return the label\n *\n * @returns {string} label\n */\nFilter.prototype.getLabel = function () {\n  return this.graph.filterLabel;\n};\n\n/**\n * Return the columnIndex of the filter\n *\n * @returns {number} columnIndex\n */\nFilter.prototype.getColumn = function () {\n  return this.column;\n};\n\n/**\n * Return the currently selected value. Returns undefined if there is no selection\n *\n * @returns {*} value\n */\nFilter.prototype.getSelectedValue = function () {\n  if (this.index === undefined) return undefined;\n\n  return this.values[this.index];\n};\n\n/**\n * Retrieve all values of the filter\n *\n * @returns {Array} values\n */\nFilter.prototype.getValues = function () {\n  return this.values;\n};\n\n/**\n * Retrieve one value of the filter\n *\n * @param {number}  index\n * @returns {*} value\n */\nFilter.prototype.getValue = function (index) {\n  if (index >= this.values.length) throw new Error(\"Index out of range\");\n\n  return this.values[index];\n};\n\n/**\n * Retrieve the (filtered) dataPoints for the currently selected filter index\n *\n * @param {number} [index] (optional)\n * @returns {Array} dataPoints\n */\nFilter.prototype._getDataPoints = function (index) {\n  if (index === undefined) index = this.index;\n\n  if (index === undefined) return [];\n\n  let dataPoints;\n  if (this.dataPoints[index]) {\n    dataPoints = this.dataPoints[index];\n  } else {\n    const f = {};\n    f.column = this.column;\n    f.value = this.values[index];\n\n    const dataView = new DataView(this.dataGroup.getDataSet(), {\n      filter: function (item) {\n        return item[f.column] == f.value;\n      },\n    }).get();\n    dataPoints = this.dataGroup._getDataPoints(dataView);\n\n    this.dataPoints[index] = dataPoints;\n  }\n\n  return dataPoints;\n};\n\n/**\n * Set a callback function when the filter is fully loaded.\n *\n * @param {Function} callback\n */\nFilter.prototype.setOnLoadCallback = function (callback) {\n  this.onLoadCallback = callback;\n};\n\n/**\n * Add a value to the list with available values for this filter\n * No double entries will be created.\n *\n * @param {number} index\n */\nFilter.prototype.selectValue = function (index) {\n  if (index >= this.values.length) throw new Error(\"Index out of range\");\n\n  this.index = index;\n  this.value = this.values[index];\n};\n\n/**\n * Load all filtered rows in the background one by one\n * Start this method without providing an index!\n *\n * @param {number} [index=0]\n */\nFilter.prototype.loadInBackground = function (index) {\n  if (index === undefined) index = 0;\n\n  const frame = this.graph.frame;\n\n  if (index < this.values.length) {\n    // create a progress box\n    if (frame.progress === undefined) {\n      frame.progress = document.createElement(\"DIV\");\n      frame.progress.style.position = \"absolute\";\n      frame.progress.style.color = \"gray\";\n      frame.appendChild(frame.progress);\n    }\n    const progress = this.getLoadedProgress();\n    frame.progress.innerHTML = \"Loading animation... \" + progress + \"%\";\n    // TODO: this is no nice solution...\n    frame.progress.style.bottom = 60 + \"px\"; // TODO: use height of slider\n    frame.progress.style.left = 10 + \"px\";\n\n    const me = this;\n    setTimeout(function () {\n      me.loadInBackground(index + 1);\n    }, 10);\n    this.loaded = false;\n  } else {\n    this.loaded = true;\n\n    // remove the progress box\n    if (frame.progress !== undefined) {\n      frame.removeChild(frame.progress);\n      frame.progress = undefined;\n    }\n\n    if (this.onLoadCallback) this.onLoadCallback();\n  }\n};\n\nexport default Filter;\n","import { DataSet } from \"vis-data/esnext\";\nimport { DataView } from \"vis-data/esnext\";\nimport Range from \"./Range\";\nimport Filter from \"./Filter\";\nimport { STYLE } from \"./Settings\";\nimport Point3d from \"./Point3d\";\n\n/**\n * Creates a container for all data of one specific 3D-graph.\n *\n * On construction, the container is totally empty; the data\n * needs to be initialized with method initializeData().\n * Failure to do so will result in the following exception begin thrown\n * on instantiation of Graph3D:\n *\n *     Error: Array, DataSet, or DataView expected\n *\n * @function Object() { [native code] } DataGroup\n */\nfunction DataGroup() {\n  this.dataTable = null; // The original data table\n}\n\n/**\n * Initializes the instance from the passed data.\n *\n * Calculates minimum and maximum values and column index values.\n *\n * The graph3d instance is used internally to access the settings for\n * the given instance.\n * TODO: Pass settings only instead.\n *\n * @param {vis.Graph3d}  graph3d Reference to the calling Graph3D instance.\n * @param {Array | DataSet | DataView} rawData The data containing the items for\n *                                             the Graph.\n * @param {number}   style   Style Number\n * @returns {Array.<object>}\n */\nDataGroup.prototype.initializeData = function (graph3d, rawData, style) {\n  if (rawData === undefined) return;\n\n  if (Array.isArray(rawData)) {\n    rawData = new DataSet(rawData);\n  }\n\n  let data;\n  if (rawData instanceof DataSet || rawData instanceof DataView) {\n    data = rawData.get();\n  } else {\n    throw new Error(\"Array, DataSet, or DataView expected\");\n  }\n\n  if (data.length == 0) return;\n\n  this.style = style;\n\n  // unsubscribe from the dataTable\n  if (this.dataSet) {\n    this.dataSet.off(\"*\", this._onChange);\n  }\n\n  this.dataSet = rawData;\n  this.dataTable = data;\n\n  // subscribe to changes in the dataset\n  const me = this;\n  this._onChange = function () {\n    graph3d.setData(me.dataSet);\n  };\n  this.dataSet.on(\"*\", this._onChange);\n\n  // determine the location of x,y,z,value,filter columns\n  this.colX = \"x\";\n  this.colY = \"y\";\n  this.colZ = \"z\";\n\n  const withBars = graph3d.hasBars(style);\n\n  // determine barWidth from data\n  if (withBars) {\n    if (graph3d.defaultXBarWidth !== undefined) {\n      this.xBarWidth = graph3d.defaultXBarWidth;\n    } else {\n      this.xBarWidth = this.getSmallestDifference(data, this.colX) || 1;\n    }\n\n    if (graph3d.defaultYBarWidth !== undefined) {\n      this.yBarWidth = graph3d.defaultYBarWidth;\n    } else {\n      this.yBarWidth = this.getSmallestDifference(data, this.colY) || 1;\n    }\n  }\n\n  // calculate minima and maxima\n  this._initializeRange(data, this.colX, graph3d, withBars);\n  this._initializeRange(data, this.colY, graph3d, withBars);\n  this._initializeRange(data, this.colZ, graph3d, false);\n\n  if (Object.prototype.hasOwnProperty.call(data[0], \"style\")) {\n    this.colValue = \"style\";\n    const valueRange = this.getColumnRange(data, this.colValue);\n    this._setRangeDefaults(\n      valueRange,\n      graph3d.defaultValueMin,\n      graph3d.defaultValueMax\n    );\n    this.valueRange = valueRange;\n  } else {\n    this.colValue = \"z\";\n    this.valueRange = this.zRange;\n  }\n\n  // Initialize data filter if a filter column is provided\n  const table = this.getDataTable();\n  if (Object.prototype.hasOwnProperty.call(table[0], \"filter\")) {\n    if (this.dataFilter === undefined) {\n      this.dataFilter = new Filter(this, \"filter\", graph3d);\n      this.dataFilter.setOnLoadCallback(function () {\n        graph3d.redraw();\n      });\n    }\n  }\n\n  let dataPoints;\n  if (this.dataFilter) {\n    // apply filtering\n    dataPoints = this.dataFilter._getDataPoints();\n  } else {\n    // no filtering. load all data\n    dataPoints = this._getDataPoints(this.getDataTable());\n  }\n  return dataPoints;\n};\n\n/**\n * Collect the range settings for the given data column.\n *\n * This internal method is intended to make the range\n * initalization more generic.\n *\n * TODO: if/when combined settings per axis defined, get rid of this.\n *\n * @private\n * @param {'x'|'y'|'z'} column  The data column to process\n * @param {vis.Graph3d} graph3d Reference to the calling Graph3D instance;\n *                              required for access to settings\n * @returns {object}\n */\nDataGroup.prototype._collectRangeSettings = function (column, graph3d) {\n  const index = [\"x\", \"y\", \"z\"].indexOf(column);\n\n  if (index == -1) {\n    throw new Error(\"Column '\" + column + \"' invalid\");\n  }\n\n  const upper = column.toUpperCase();\n\n  return {\n    barWidth: this[column + \"BarWidth\"],\n    min: graph3d[\"default\" + upper + \"Min\"],\n    max: graph3d[\"default\" + upper + \"Max\"],\n    step: graph3d[\"default\" + upper + \"Step\"],\n    range_label: column + \"Range\", // Name of instance field to write to\n    step_label: column + \"Step\", // Name of instance field to write to\n  };\n};\n\n/**\n * Initializes the settings per given column.\n *\n * TODO: if/when combined settings per axis defined, rewrite this.\n *\n * @private\n * @param {DataSet | DataView} data     The data containing the items for the Graph\n * @param {'x'|'y'|'z'}        column   The data column to process\n * @param {vis.Graph3d}        graph3d  Reference to the calling Graph3D instance;\n *                                      required for access to settings\n * @param {boolean}            withBars True if initializing for bar graph\n */\nDataGroup.prototype._initializeRange = function (\n  data,\n  column,\n  graph3d,\n  withBars\n) {\n  const NUMSTEPS = 5;\n  const settings = this._collectRangeSettings(column, graph3d);\n\n  const range = this.getColumnRange(data, column);\n  if (withBars && column != \"z\") {\n    // Safeguard for 'z'; it doesn't have a bar width\n    range.expand(settings.barWidth / 2);\n  }\n\n  this._setRangeDefaults(range, settings.min, settings.max);\n  this[settings.range_label] = range;\n  this[settings.step_label] =\n    settings.step !== undefined ? settings.step : range.range() / NUMSTEPS;\n};\n\n/**\n * Creates a list with all the different values in the data for the given column.\n *\n * If no data passed, use the internal data of this instance.\n *\n * @param {'x'|'y'|'z'}                column The data column to process\n * @param {DataSet|DataView|undefined} data   The data containing the items for the Graph\n * @returns {Array} All distinct values in the given column data, sorted ascending.\n */\nDataGroup.prototype.getDistinctValues = function (column, data) {\n  if (data === undefined) {\n    data = this.dataTable;\n  }\n\n  const values = [];\n\n  for (let i = 0; i < data.length; i++) {\n    const value = data[i][column] || 0;\n    if (values.indexOf(value) === -1) {\n      values.push(value);\n    }\n  }\n\n  return values.sort(function (a, b) {\n    return a - b;\n  });\n};\n\n/**\n * Determine the smallest difference between the values for given\n * column in the passed data set.\n *\n * @param {DataSet|DataView|undefined} data   The data containing the items for the Graph\n * @param {'x'|'y'|'z'}                column The data column to process\n * @returns {number|null} Smallest difference value or\n *                        null, if it can't be determined.\n */\nDataGroup.prototype.getSmallestDifference = function (data, column) {\n  const values = this.getDistinctValues(data, column);\n\n  // Get all the distinct diffs\n  // Array values is assumed to be sorted here\n  let smallest_diff = null;\n\n  for (let i = 1; i < values.length; i++) {\n    const diff = values[i] - values[i - 1];\n\n    if (smallest_diff == null || smallest_diff > diff) {\n      smallest_diff = diff;\n    }\n  }\n\n  return smallest_diff;\n};\n\n/**\n * Get the absolute min/max values for the passed data column.\n *\n * @param {DataSet|DataView|undefined} data   The data containing the items for the Graph\n * @param {'x'|'y'|'z'}                column The data column to process\n * @returns {Range} A Range instance with min/max members properly set.\n */\nDataGroup.prototype.getColumnRange = function (data, column) {\n  const range = new Range();\n\n  // Adjust the range so that it covers all values in the passed data elements.\n  for (let i = 0; i < data.length; i++) {\n    const item = data[i][column];\n    range.adjust(item);\n  }\n\n  return range;\n};\n\n/**\n * Determines the number of rows in the current data.\n *\n * @returns {number}\n */\nDataGroup.prototype.getNumberOfRows = function () {\n  return this.dataTable.length;\n};\n\n/**\n * Set default values for range\n *\n * The default values override the range values, if defined.\n *\n * Because it's possible that only defaultMin or defaultMax is set, it's better\n * to pass in a range already set with the min/max set from the data. Otherwise,\n * it's quite hard to process the min/max properly.\n *\n * @param {vis.Range} range\n * @param {number} [defaultMin=range.min]\n * @param {number} [defaultMax=range.max]\n * @private\n */\nDataGroup.prototype._setRangeDefaults = function (\n  range,\n  defaultMin,\n  defaultMax\n) {\n  if (defaultMin !== undefined) {\n    range.min = defaultMin;\n  }\n\n  if (defaultMax !== undefined) {\n    range.max = defaultMax;\n  }\n\n  // This is the original way that the default min/max values were adjusted.\n  // TODO: Perhaps it's better if an error is thrown if the values do not agree.\n  //       But this will change the behaviour.\n  if (range.max <= range.min) range.max = range.min + 1;\n};\n\nDataGroup.prototype.getDataTable = function () {\n  return this.dataTable;\n};\n\nDataGroup.prototype.getDataSet = function () {\n  return this.dataSet;\n};\n\n/**\n * Return all data values as a list of Point3d objects\n *\n * @param {Array.<object>} data\n * @returns {Array.<object>}\n */\nDataGroup.prototype.getDataPoints = function (data) {\n  const dataPoints = [];\n\n  for (let i = 0; i < data.length; i++) {\n    const point = new Point3d();\n    point.x = data[i][this.colX] || 0;\n    point.y = data[i][this.colY] || 0;\n    point.z = data[i][this.colZ] || 0;\n    point.data = data[i];\n    point.value = data[i][this.colValue] || 0;\n\n    const obj = {};\n    obj.point = point;\n    obj.bottom = new Point3d(point.x, point.y, this.zRange.min);\n    obj.trans = undefined;\n    obj.screen = undefined;\n\n    dataPoints.push(obj);\n  }\n\n  return dataPoints;\n};\n\n/**\n * Copy all values from the data table to a matrix.\n *\n * The provided values are supposed to form a grid of (x,y) positions.\n *\n * @param {Array.<object>} data\n * @returns {Array.<object>}\n * @private\n */\nDataGroup.prototype.initDataAsMatrix = function (data) {\n  // TODO: store the created matrix dataPoints in the filters instead of\n  //       reloading each time.\n  let x, y, i, obj;\n\n  // create two lists with all present x and y values\n  const dataX = this.getDistinctValues(this.colX, data);\n  const dataY = this.getDistinctValues(this.colY, data);\n\n  const dataPoints = this.getDataPoints(data);\n\n  // create a grid, a 2d matrix, with all values.\n  const dataMatrix = []; // temporary data matrix\n  for (i = 0; i < dataPoints.length; i++) {\n    obj = dataPoints[i];\n\n    // TODO: implement Array().indexOf() for Internet Explorer\n    const xIndex = dataX.indexOf(obj.point.x);\n    const yIndex = dataY.indexOf(obj.point.y);\n\n    if (dataMatrix[xIndex] === undefined) {\n      dataMatrix[xIndex] = [];\n    }\n\n    dataMatrix[xIndex][yIndex] = obj;\n  }\n\n  // fill in the pointers to the neighbors.\n  for (x = 0; x < dataMatrix.length; x++) {\n    for (y = 0; y < dataMatrix[x].length; y++) {\n      if (dataMatrix[x][y]) {\n        dataMatrix[x][y].pointRight =\n          x < dataMatrix.length - 1 ? dataMatrix[x + 1][y] : undefined;\n        dataMatrix[x][y].pointTop =\n          y < dataMatrix[x].length - 1 ? dataMatrix[x][y + 1] : undefined;\n        dataMatrix[x][y].pointCross =\n          x < dataMatrix.length - 1 && y < dataMatrix[x].length - 1\n            ? dataMatrix[x + 1][y + 1]\n            : undefined;\n      }\n    }\n  }\n\n  return dataPoints;\n};\n\n/**\n * Return common information, if present\n *\n * @returns {string}\n */\nDataGroup.prototype.getInfo = function () {\n  const dataFilter = this.dataFilter;\n  if (!dataFilter) return undefined;\n\n  return dataFilter.getLabel() + \": \" + dataFilter.getSelectedValue();\n};\n\n/**\n * Reload the data\n */\nDataGroup.prototype.reload = function () {\n  if (this.dataTable) {\n    this.setData(this.dataTable);\n  }\n};\n\n/**\n * Filter the data based on the current filter\n *\n * @param   {Array} data\n * @returns {Array} dataPoints Array with point objects which can be drawn on\n *                             screen\n */\nDataGroup.prototype._getDataPoints = function (data) {\n  let dataPoints = [];\n\n  if (this.style === STYLE.GRID || this.style === STYLE.SURFACE) {\n    dataPoints = this.initDataAsMatrix(data);\n  } else {\n    // 'dot', 'dot-line', etc.\n    dataPoints = this.getDataPoints(data);\n\n    if (this.style === STYLE.LINE) {\n      // Add next member points for line drawing\n      for (let i = 0; i < dataPoints.length; i++) {\n        if (i > 0) {\n          dataPoints[i - 1].pointNext = dataPoints[i];\n        }\n      }\n    }\n  }\n\n  return dataPoints;\n};\n\nexport default DataGroup;\n","import Emitter from \"component-emitter\";\nimport * as util from \"vis-util/esnext\";\nimport Point3d from \"./Point3d\";\nimport Point2d from \"./Point2d\";\nimport Slider from \"./Slider\";\nimport StepNumber from \"./StepNumber\";\nimport { STYLE, setCameraPosition, setDefaults, setOptions } from \"./Settings\";\nimport { VALIDATOR_PRINT_STYLE, Validator } from \"vis-util/esnext\";\nimport { allOptions } from \"./options.js\";\nimport DataGroup from \"./DataGroup\";\n\n/// enumerate the available styles\nGraph3d.STYLE = STYLE;\n\n/**\n * Following label is used in the settings to describe values which should be\n * determined by the code while running, from the current data and graph style.\n *\n * Using 'undefined' directly achieves the same thing, but this is more\n * descriptive by describing the intent.\n */\nconst autoByDefault = undefined;\n\n/**\n * Default values for option settings.\n *\n * These are the values used when a Graph3d instance is initialized without\n * custom settings.\n *\n * If a field is not in this list, a default value of 'autoByDefault' is assumed,\n * which is just an alias for 'undefined'.\n */\nGraph3d.DEFAULTS = {\n  width: \"400px\",\n  height: \"400px\",\n  filterLabel: \"time\",\n  legendLabel: \"value\",\n  xLabel: \"x\",\n  yLabel: \"y\",\n  zLabel: \"z\",\n  xValueLabel: function (v) {\n    return v;\n  },\n  yValueLabel: function (v) {\n    return v;\n  },\n  zValueLabel: function (v) {\n    return v;\n  },\n  showXAxis: true,\n  showYAxis: true,\n  showZAxis: true,\n  showGrayBottom: false,\n  showGrid: true,\n  showPerspective: true,\n  showShadow: false,\n  showSurfaceGrid: true,\n  keepAspectRatio: true,\n  rotateAxisLabels: true,\n  verticalRatio: 0.5, // 0.1 to 1.0, where 1.0 results in a 'cube'\n\n  dotSizeRatio: 0.02, // size of the dots as a fraction of the graph width\n  dotSizeMinFraction: 0.5, // size of min-value dot as a fraction of dotSizeRatio\n  dotSizeMaxFraction: 2.5, // size of max-value dot as a fraction of dotSizeRatio\n\n  showAnimationControls: autoByDefault,\n  animationInterval: 1000, // milliseconds\n  animationPreload: false,\n  animationAutoStart: autoByDefault,\n\n  axisFontSize: 14,\n  axisFontType: \"arial\",\n  axisColor: \"#4D4D4D\",\n  gridColor: \"#D3D3D3\",\n  xCenter: \"55%\",\n  yCenter: \"50%\",\n\n  style: Graph3d.STYLE.DOT,\n  tooltip: false,\n  tooltipDelay: 300, // milliseconds\n\n  tooltipStyle: {\n    content: {\n      padding: \"10px\",\n      border: \"1px solid #4d4d4d\",\n      color: \"#1a1a1a\",\n      background: \"rgba(255,255,255,0.7)\",\n      borderRadius: \"2px\",\n      boxShadow: \"5px 5px 10px rgba(128,128,128,0.5)\",\n    },\n    line: {\n      height: \"40px\",\n      width: \"0\",\n      borderLeft: \"1px solid #4d4d4d\",\n      pointerEvents: \"none\",\n    },\n    dot: {\n      height: \"0\",\n      width: \"0\",\n      border: \"5px solid #4d4d4d\",\n      borderRadius: \"5px\",\n      pointerEvents: \"none\",\n    },\n  },\n\n  dataColor: {\n    fill: \"#7DC1FF\",\n    stroke: \"#3267D2\",\n    strokeWidth: 1, // px\n  },\n\n  surfaceColors: autoByDefault,\n  colormap: autoByDefault,\n\n  cameraPosition: {\n    horizontal: 1.0,\n    vertical: 0.5,\n    distance: 1.7,\n  },\n\n  zoomable: true,\n  ctrlToZoom: false,\n\n  /*\n  The following fields are 'auto by default', see above.\n */\n  showLegend: autoByDefault, // determined by graph style\n  backgroundColor: autoByDefault,\n\n  xBarWidth: autoByDefault,\n  yBarWidth: autoByDefault,\n  valueMin: autoByDefault,\n  valueMax: autoByDefault,\n  xMin: autoByDefault,\n  xMax: autoByDefault,\n  xStep: autoByDefault,\n  yMin: autoByDefault,\n  yMax: autoByDefault,\n  yStep: autoByDefault,\n  zMin: autoByDefault,\n  zMax: autoByDefault,\n  zStep: autoByDefault,\n};\n\n// -----------------------------------------------------------------------------\n// Class Graph3d\n// -----------------------------------------------------------------------------\n\n/**\n * Graph3d displays data in 3d.\n *\n * Graph3d is developed in javascript as a Google Visualization Chart.\n *\n * @function Object() { [native code] } Graph3d\n * @param {Element} container   The DOM element in which the Graph3d will\n *                              be created. Normally a div element.\n * @param {DataSet | DataView | Array} [data]\n * @param {object} [options]\n */\nfunction Graph3d(container, data, options) {\n  if (!(this instanceof Graph3d)) {\n    throw new SyntaxError(\"Constructor must be called with the new operator\");\n  }\n\n  // create variables and set default values\n  this.containerElement = container;\n\n  this.dataGroup = new DataGroup();\n  this.dataPoints = null; // The table with point objects\n\n  // create a frame and canvas\n  this.create();\n\n  setDefaults(Graph3d.DEFAULTS, this);\n\n  // the column indexes\n  this.colX = undefined;\n  this.colY = undefined;\n  this.colZ = undefined;\n  this.colValue = undefined;\n\n  // TODO: customize axis range\n\n  // apply options (also when undefined)\n  this.setOptions(options);\n\n  // apply data\n  this.setData(data);\n}\n\n// Extend Graph3d with an Emitter mixin\nEmitter(Graph3d.prototype);\n\n/**\n * Calculate the scaling values, dependent on the range in x, y, and z direction\n */\nGraph3d.prototype._setScale = function () {\n  this.scale = new Point3d(\n    1 / this.xRange.range(),\n    1 / this.yRange.range(),\n    1 / this.zRange.range()\n  );\n\n  // keep aspect ration between x and y scale if desired\n  if (this.keepAspectRatio) {\n    if (this.scale.x < this.scale.y) {\n      //noinspection JSSuspiciousNameCombination\n      this.scale.y = this.scale.x;\n    } else {\n      //noinspection JSSuspiciousNameCombination\n      this.scale.x = this.scale.y;\n    }\n  }\n\n  // scale the vertical axis\n  this.scale.z *= this.verticalRatio;\n  // TODO: can this be automated? verticalRatio?\n\n  // determine scale for (optional) value\n  if (this.valueRange !== undefined) {\n    this.scale.value = 1 / this.valueRange.range();\n  }\n\n  // position the camera arm\n  const xCenter = this.xRange.center() * this.scale.x;\n  const yCenter = this.yRange.center() * this.scale.y;\n  const zCenter = this.zRange.center() * this.scale.z;\n  this.camera.setArmLocation(xCenter, yCenter, zCenter);\n};\n\n/**\n * Convert a 3D location to a 2D location on screen\n * Source: ttp://en.wikipedia.org/wiki/3D_projection\n *\n * @param   {Point3d} point3d  A 3D point with parameters x, y, z\n * @returns {Point2d} point2d  A 2D point with parameters x, y\n */\nGraph3d.prototype._convert3Dto2D = function (point3d) {\n  const translation = this._convertPointToTranslation(point3d);\n  return this._convertTranslationToScreen(translation);\n};\n\n/**\n * Convert a 3D location its translation seen from the camera\n * Source: http://en.wikipedia.org/wiki/3D_projection\n *\n * @param   {Point3d} point3d     A 3D point with parameters x, y, z\n * @returns {Point3d} translation A 3D point with parameters x, y, z This is\n *                                the translation of the point, seen from the\n *                                camera.\n */\nGraph3d.prototype._convertPointToTranslation = function (point3d) {\n  const cameraLocation = this.camera.getCameraLocation(),\n    cameraRotation = this.camera.getCameraRotation(),\n    ax = point3d.x * this.scale.x,\n    ay = point3d.y * this.scale.y,\n    az = point3d.z * this.scale.z,\n    cx = cameraLocation.x,\n    cy = cameraLocation.y,\n    cz = cameraLocation.z,\n    // calculate angles\n    sinTx = Math.sin(cameraRotation.x),\n    cosTx = Math.cos(cameraRotation.x),\n    sinTy = Math.sin(cameraRotation.y),\n    cosTy = Math.cos(cameraRotation.y),\n    sinTz = Math.sin(cameraRotation.z),\n    cosTz = Math.cos(cameraRotation.z),\n    // calculate translation\n    dx = cosTy * (sinTz * (ay - cy) + cosTz * (ax - cx)) - sinTy * (az - cz),\n    dy =\n      sinTx *\n        (cosTy * (az - cz) + sinTy * (sinTz * (ay - cy) + cosTz * (ax - cx))) +\n      cosTx * (cosTz * (ay - cy) - sinTz * (ax - cx)),\n    dz =\n      cosTx *\n        (cosTy * (az - cz) + sinTy * (sinTz * (ay - cy) + cosTz * (ax - cx))) -\n      sinTx * (cosTz * (ay - cy) - sinTz * (ax - cx));\n\n  return new Point3d(dx, dy, dz);\n};\n\n/**\n * Convert a translation point to a point on the screen\n *\n * @param   {Point3d} translation A 3D point with parameters x, y, z This is\n *                                the translation of the point, seen from the\n *                                camera.\n * @returns {Point2d} point2d     A 2D point with parameters x, y\n */\nGraph3d.prototype._convertTranslationToScreen = function (translation) {\n  const ex = this.eye.x,\n    ey = this.eye.y,\n    ez = this.eye.z,\n    dx = translation.x,\n    dy = translation.y,\n    dz = translation.z;\n\n  // calculate position on screen from translation\n  let bx;\n  let by;\n  if (this.showPerspective) {\n    bx = (dx - ex) * (ez / dz);\n    by = (dy - ey) * (ez / dz);\n  } else {\n    bx = dx * -(ez / this.camera.getArmLength());\n    by = dy * -(ez / this.camera.getArmLength());\n  }\n\n  // shift and scale the point to the center of the screen\n  // use the width of the graph to scale both horizontally and vertically.\n  return new Point2d(\n    this.currentXCenter + bx * this.frame.canvas.clientWidth,\n    this.currentYCenter - by * this.frame.canvas.clientWidth\n  );\n};\n\n/**\n * Calculate the translations and screen positions of all points\n *\n * @param {Array.<Point3d>} points\n * @private\n */\nGraph3d.prototype._calcTranslations = function (points) {\n  for (let i = 0; i < points.length; i++) {\n    const point = points[i];\n    point.trans = this._convertPointToTranslation(point.point);\n    point.screen = this._convertTranslationToScreen(point.trans);\n\n    // calculate the translation of the point at the bottom (needed for sorting)\n    const transBottom = this._convertPointToTranslation(point.bottom);\n    point.dist = this.showPerspective ? transBottom.length() : -transBottom.z;\n  }\n\n  // sort the points on depth of their (x,y) position (not on z)\n  const sortDepth = function (a, b) {\n    return b.dist - a.dist;\n  };\n  points.sort(sortDepth);\n};\n\n/**\n * Transfer min/max values to the Graph3d instance.\n */\nGraph3d.prototype._initializeRanges = function () {\n  // TODO: later on, all min/maxes of all datagroups will be combined here\n  const dg = this.dataGroup;\n  this.xRange = dg.xRange;\n  this.yRange = dg.yRange;\n  this.zRange = dg.zRange;\n  this.valueRange = dg.valueRange;\n\n  // Values currently needed but which need to be sorted out for\n  // the multiple graph case.\n  this.xStep = dg.xStep;\n  this.yStep = dg.yStep;\n  this.zStep = dg.zStep;\n  this.xBarWidth = dg.xBarWidth;\n  this.yBarWidth = dg.yBarWidth;\n  this.colX = dg.colX;\n  this.colY = dg.colY;\n  this.colZ = dg.colZ;\n  this.colValue = dg.colValue;\n\n  // set the scale dependent on the ranges.\n  this._setScale();\n};\n\n/**\n * Return all data values as a list of Point3d objects\n *\n * @param {vis.DataSet} data\n * @returns {Array.<object>}\n */\nGraph3d.prototype.getDataPoints = function (data) {\n  const dataPoints = [];\n\n  for (let i = 0; i < data.length; i++) {\n    const point = new Point3d();\n    point.x = data[i][this.colX] || 0;\n    point.y = data[i][this.colY] || 0;\n    point.z = data[i][this.colZ] || 0;\n    point.data = data[i];\n    point.value = data[i][this.colValue] || 0;\n\n    const obj = {};\n    obj.point = point;\n    obj.bottom = new Point3d(point.x, point.y, this.zRange.min);\n    obj.trans = undefined;\n    obj.screen = undefined;\n\n    dataPoints.push(obj);\n  }\n\n  return dataPoints;\n};\n\n/**\n * Filter the data based on the current filter\n *\n * @param   {Array} data\n * @returns {Array} dataPoints Array with point objects which can be drawn on\n *                             screen\n */\nGraph3d.prototype._getDataPoints = function (data) {\n  // TODO: store the created matrix dataPoints in the filters instead of\n  //       reloading each time.\n  let x, y, i, obj;\n\n  let dataPoints = [];\n\n  if (\n    this.style === Graph3d.STYLE.GRID ||\n    this.style === Graph3d.STYLE.SURFACE\n  ) {\n    // copy all values from the data table to a matrix\n    // the provided values are supposed to form a grid of (x,y) positions\n\n    // create two lists with all present x and y values\n    const dataX = this.dataGroup.getDistinctValues(this.colX, data);\n    const dataY = this.dataGroup.getDistinctValues(this.colY, data);\n\n    dataPoints = this.getDataPoints(data);\n\n    // create a grid, a 2d matrix, with all values.\n    const dataMatrix = []; // temporary data matrix\n    for (i = 0; i < dataPoints.length; i++) {\n      obj = dataPoints[i];\n\n      // TODO: implement Array().indexOf() for Internet Explorer\n      const xIndex = dataX.indexOf(obj.point.x);\n      const yIndex = dataY.indexOf(obj.point.y);\n\n      if (dataMatrix[xIndex] === undefined) {\n        dataMatrix[xIndex] = [];\n      }\n\n      dataMatrix[xIndex][yIndex] = obj;\n    }\n\n    // fill in the pointers to the neighbors.\n    for (x = 0; x < dataMatrix.length; x++) {\n      for (y = 0; y < dataMatrix[x].length; y++) {\n        if (dataMatrix[x][y]) {\n          dataMatrix[x][y].pointRight =\n            x < dataMatrix.length - 1 ? dataMatrix[x + 1][y] : undefined;\n          dataMatrix[x][y].pointTop =\n            y < dataMatrix[x].length - 1 ? dataMatrix[x][y + 1] : undefined;\n          dataMatrix[x][y].pointCross =\n            x < dataMatrix.length - 1 && y < dataMatrix[x].length - 1\n              ? dataMatrix[x + 1][y + 1]\n              : undefined;\n        }\n      }\n    }\n  } else {\n    // 'dot', 'dot-line', etc.\n    dataPoints = this.getDataPoints(data);\n\n    if (this.style === Graph3d.STYLE.LINE) {\n      // Add next member points for line drawing\n      for (i = 0; i < dataPoints.length; i++) {\n        if (i > 0) {\n          dataPoints[i - 1].pointNext = dataPoints[i];\n        }\n      }\n    }\n  }\n\n  return dataPoints;\n};\n\n/**\n * Create the main frame for the Graph3d.\n *\n * This function is executed once when a Graph3d object is created. The frame\n * contains a canvas, and this canvas contains all objects like the axis and\n * nodes.\n */\nGraph3d.prototype.create = function () {\n  // remove all elements from the container element.\n  while (this.containerElement.hasChildNodes()) {\n    this.containerElement.removeChild(this.containerElement.firstChild);\n  }\n\n  this.frame = document.createElement(\"div\");\n  this.frame.style.position = \"relative\";\n  this.frame.style.overflow = \"hidden\";\n\n  // create the graph canvas (HTML canvas element)\n  this.frame.canvas = document.createElement(\"canvas\");\n  this.frame.canvas.style.position = \"relative\";\n  this.frame.appendChild(this.frame.canvas);\n  //if (!this.frame.canvas.getContext) {\n  {\n    const noCanvas = document.createElement(\"DIV\");\n    noCanvas.style.color = \"red\";\n    noCanvas.style.fontWeight = \"bold\";\n    noCanvas.style.padding = \"10px\";\n    noCanvas.innerHTML = \"Error: your browser does not support HTML canvas\";\n    this.frame.canvas.appendChild(noCanvas);\n  }\n\n  this.frame.filter = document.createElement(\"div\");\n  this.frame.filter.style.position = \"absolute\";\n  this.frame.filter.style.bottom = \"0px\";\n  this.frame.filter.style.left = \"0px\";\n  this.frame.filter.style.width = \"100%\";\n  this.frame.appendChild(this.frame.filter);\n\n  // add event listeners to handle moving and zooming the contents\n  const me = this;\n  const onmousedown = function (event) {\n    me._onMouseDown(event);\n  };\n  const ontouchstart = function (event) {\n    me._onTouchStart(event);\n  };\n  const onmousewheel = function (event) {\n    me._onWheel(event);\n  };\n  const ontooltip = function (event) {\n    me._onTooltip(event);\n  };\n  const onclick = function (event) {\n    me._onClick(event);\n  };\n  // TODO: these events are never cleaned up... can give a 'memory leakage'\n\n  this.frame.canvas.addEventListener(\"mousedown\", onmousedown);\n  this.frame.canvas.addEventListener(\"touchstart\", ontouchstart);\n  this.frame.canvas.addEventListener(\"mousewheel\", onmousewheel);\n  this.frame.canvas.addEventListener(\"mousemove\", ontooltip);\n  this.frame.canvas.addEventListener(\"click\", onclick);\n\n  // add the new graph to the container element\n  this.containerElement.appendChild(this.frame);\n};\n\n/**\n * Set a new size for the graph\n *\n * @param {number} width\n * @param {number} height\n * @private\n */\nGraph3d.prototype._setSize = function (width, height) {\n  this.frame.style.width = width;\n  this.frame.style.height = height;\n\n  this._resizeCanvas();\n};\n\n/**\n * Resize the canvas to the current size of the frame\n */\nGraph3d.prototype._resizeCanvas = function () {\n  this.frame.canvas.style.width = \"100%\";\n  this.frame.canvas.style.height = \"100%\";\n\n  this.frame.canvas.width = this.frame.canvas.clientWidth;\n  this.frame.canvas.height = this.frame.canvas.clientHeight;\n\n  // adjust with for margin\n  this.frame.filter.style.width = this.frame.canvas.clientWidth - 2 * 10 + \"px\";\n};\n\n/**\n * Start playing the animation, if requested and filter present. Only applicable\n * when animation data is available.\n */\nGraph3d.prototype.animationStart = function () {\n  // start animation when option is true\n  if (!this.animationAutoStart || !this.dataGroup.dataFilter) return;\n\n  if (!this.frame.filter || !this.frame.filter.slider)\n    throw new Error(\"No animation available\");\n\n  this.frame.filter.slider.play();\n};\n\n/**\n * Stop animation\n */\nGraph3d.prototype.animationStop = function () {\n  if (!this.frame.filter || !this.frame.filter.slider) return;\n\n  this.frame.filter.slider.stop();\n};\n\n/**\n * Resize the center position based on the current values in this.xCenter\n * and this.yCenter (which are strings with a percentage or a value\n * in pixels). The center positions are the variables this.currentXCenter\n * and this.currentYCenter\n */\nGraph3d.prototype._resizeCenter = function () {\n  // calculate the horizontal center position\n  if (this.xCenter.charAt(this.xCenter.length - 1) === \"%\") {\n    this.currentXCenter =\n      (parseFloat(this.xCenter) / 100) * this.frame.canvas.clientWidth;\n  } else {\n    this.currentXCenter = parseFloat(this.xCenter); // supposed to be in px\n  }\n\n  // calculate the vertical center position\n  if (this.yCenter.charAt(this.yCenter.length - 1) === \"%\") {\n    this.currentYCenter =\n      (parseFloat(this.yCenter) / 100) *\n      (this.frame.canvas.clientHeight - this.frame.filter.clientHeight);\n  } else {\n    this.currentYCenter = parseFloat(this.yCenter); // supposed to be in px\n  }\n};\n\n/**\n * Retrieve the current camera rotation\n *\n * @returns {object} An object with parameters horizontal, vertical, and\n *                   distance\n */\nGraph3d.prototype.getCameraPosition = function () {\n  const pos = this.camera.getArmRotation();\n  pos.distance = this.camera.getArmLength();\n  return pos;\n};\n\n/**\n * Load data into the 3D Graph\n *\n * @param {vis.DataSet} data\n * @private\n */\nGraph3d.prototype._readData = function (data) {\n  // read the data\n  this.dataPoints = this.dataGroup.initializeData(this, data, this.style);\n\n  this._initializeRanges();\n  this._redrawFilter();\n};\n\n/**\n * Replace the dataset of the Graph3d\n *\n * @param {Array | DataSet | DataView} data\n */\nGraph3d.prototype.setData = function (data) {\n  if (data === undefined || data === null) return;\n\n  this._readData(data);\n  this.redraw();\n  this.animationStart();\n};\n\n/**\n * Update the options. Options will be merged with current options\n *\n * @param {object} options\n */\nGraph3d.prototype.setOptions = function (options) {\n  if (options === undefined) return;\n\n  const errorFound = Validator.validate(options, allOptions);\n  if (errorFound === true) {\n    console.error(\n      \"%cErrors have been found in the supplied options object.\",\n      VALIDATOR_PRINT_STYLE\n    );\n  }\n\n  this.animationStop();\n\n  setOptions(options, this);\n  this.setPointDrawingMethod();\n  this._setSize(this.width, this.height);\n  this.setAxisLabelMethod();\n\n  this.setData(this.dataGroup.getDataTable());\n  this.animationStart();\n};\n\n/**\n * Determine which point drawing method to use for the current graph style.\n */\nGraph3d.prototype.setPointDrawingMethod = function () {\n  let method = undefined;\n\n  switch (this.style) {\n    case Graph3d.STYLE.BAR:\n      method = this._redrawBarGraphPoint;\n      break;\n    case Graph3d.STYLE.BARCOLOR:\n      method = this._redrawBarColorGraphPoint;\n      break;\n    case Graph3d.STYLE.BARSIZE:\n      method = this._redrawBarSizeGraphPoint;\n      break;\n    case Graph3d.STYLE.DOT:\n      method = this._redrawDotGraphPoint;\n      break;\n    case Graph3d.STYLE.DOTLINE:\n      method = this._redrawDotLineGraphPoint;\n      break;\n    case Graph3d.STYLE.DOTCOLOR:\n      method = this._redrawDotColorGraphPoint;\n      break;\n    case Graph3d.STYLE.DOTSIZE:\n      method = this._redrawDotSizeGraphPoint;\n      break;\n    case Graph3d.STYLE.SURFACE:\n      method = this._redrawSurfaceGraphPoint;\n      break;\n    case Graph3d.STYLE.GRID:\n      method = this._redrawGridGraphPoint;\n      break;\n    case Graph3d.STYLE.LINE:\n      method = this._redrawLineGraphPoint;\n      break;\n    default:\n      throw new Error(\n        \"Can not determine point drawing method \" +\n          \"for graph style '\" +\n          this.style +\n          \"'\"\n      );\n  }\n\n  this._pointDrawingMethod = method;\n};\n\n/**\n * Determine which functions to use to draw axis labels.\n */\nGraph3d.prototype.setAxisLabelMethod = function () {\n  if (this.rotateAxisLabels) {\n    this._drawAxisLabelX = this.drawAxisLabelXRotate;\n    this._drawAxisLabelY = this.drawAxisLabelYRotate;\n    this._drawAxisLabelZ = this.drawAxisLabelZRotate;\n  } else {\n    this._drawAxisLabelX = this.drawAxisLabelX;\n    this._drawAxisLabelY = this.drawAxisLabelY;\n    this._drawAxisLabelZ = this.drawAxisLabelZ;\n  }\n};\n\n/**\n * Redraw the Graph.\n */\nGraph3d.prototype.redraw = function () {\n  if (this.dataPoints === undefined) {\n    throw new Error(\"Graph data not initialized\");\n  }\n\n  this._resizeCanvas();\n  this._resizeCenter();\n  this._redrawSlider();\n  this._redrawClear();\n  this._redrawAxis();\n\n  this._redrawDataGraph();\n\n  this._redrawInfo();\n  this._redrawLegend();\n};\n\n/**\n * Get drawing context without exposing canvas\n *\n * @returns {CanvasRenderingContext2D}\n * @private\n */\nGraph3d.prototype._getContext = function () {\n  const canvas = this.frame.canvas;\n  const ctx = canvas.getContext(\"2d\");\n\n  ctx.lineJoin = \"round\";\n  ctx.lineCap = \"round\";\n\n  return ctx;\n};\n\n/**\n * Clear the canvas before redrawing\n */\nGraph3d.prototype._redrawClear = function () {\n  const canvas = this.frame.canvas;\n  const ctx = canvas.getContext(\"2d\");\n\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n};\n\nGraph3d.prototype._dotSize = function () {\n  return this.frame.clientWidth * this.dotSizeRatio;\n};\n\n/**\n * Get legend width\n *\n * @returns {*}\n * @private\n */\nGraph3d.prototype._getLegendWidth = function () {\n  let width;\n\n  if (this.style === Graph3d.STYLE.DOTSIZE) {\n    const dotSize = this._dotSize();\n    //width =  dotSize / 2 + dotSize * 2;\n    width = dotSize * this.dotSizeMaxFraction;\n  } else if (this.style === Graph3d.STYLE.BARSIZE) {\n    width = this.xBarWidth;\n  } else {\n    width = 20;\n  }\n  return width;\n};\n\n/**\n * Redraw the legend based on size, dot color, or surface height\n */\nGraph3d.prototype._redrawLegend = function () {\n  //Return without drawing anything, if no legend is specified\n  if (this.showLegend !== true) {\n    return;\n  }\n\n  // Do not draw legend when graph style does not support\n  if (\n    this.style === Graph3d.STYLE.LINE ||\n    this.style === Graph3d.STYLE.BARSIZE //TODO add legend support for BARSIZE\n  ) {\n    return;\n  }\n\n  // Legend types - size and color. Determine if size legend.\n  const isSizeLegend =\n    this.style === Graph3d.STYLE.BARSIZE ||\n    this.style === Graph3d.STYLE.DOTSIZE;\n\n  // Legend is either tracking z values or style values. This flag if false means use z values.\n  const isValueLegend =\n    this.style === Graph3d.STYLE.DOTSIZE ||\n    this.style === Graph3d.STYLE.DOTCOLOR ||\n    this.style === Graph3d.STYLE.SURFACE ||\n    this.style === Graph3d.STYLE.BARCOLOR;\n\n  const height = Math.max(this.frame.clientHeight * 0.25, 100);\n  const top = this.margin;\n  const width = this._getLegendWidth(); // px - overwritten by size legend\n  const right = this.frame.clientWidth - this.margin;\n  const left = right - width;\n  const bottom = top + height;\n\n  const ctx = this._getContext();\n  ctx.lineWidth = 1;\n  ctx.font = \"14px arial\"; // TODO: put in options\n\n  if (isSizeLegend === false) {\n    // draw the color bar\n    const ymin = 0;\n    const ymax = height; // Todo: make height customizable\n    let y;\n\n    for (y = ymin; y < ymax; y++) {\n      // Need (1 - x) because y runs from top to bottom:\n      const f = 1 - (y - ymin) / (ymax - ymin);\n      const color = this._colormap(f, 1);\n\n      ctx.strokeStyle = color;\n      ctx.beginPath();\n      ctx.moveTo(left, top + y);\n      ctx.lineTo(right, top + y);\n      ctx.stroke();\n    }\n    ctx.strokeStyle = this.axisColor;\n    ctx.strokeRect(left, top, width, height);\n  } else {\n    // draw the size legend box\n    let widthMin;\n    if (this.style === Graph3d.STYLE.DOTSIZE) {\n      // Get the proportion to max and min right\n      widthMin = width * (this.dotSizeMinFraction / this.dotSizeMaxFraction);\n    } else if (this.style === Graph3d.STYLE.BARSIZE) {\n      //widthMin = this.xBarWidth * 0.2 this is wrong - barwidth measures in terms of xvalues\n    }\n    ctx.strokeStyle = this.axisColor;\n    ctx.fillStyle = this.dataColor.fill;\n    ctx.beginPath();\n    ctx.moveTo(left, top);\n    ctx.lineTo(right, top);\n    ctx.lineTo(left + widthMin, bottom);\n    ctx.lineTo(left, bottom);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n  }\n\n  // print value text along the legend edge\n  const gridLineLen = 5; // px\n\n  const legendMin = isValueLegend ? this.valueRange.min : this.zRange.min;\n  const legendMax = isValueLegend ? this.valueRange.max : this.zRange.max;\n  const step = new StepNumber(\n    legendMin,\n    legendMax,\n    (legendMax - legendMin) / 5,\n    true\n  );\n  step.start(true);\n\n  while (!step.end()) {\n    const y =\n      bottom -\n      ((step.getCurrent() - legendMin) / (legendMax - legendMin)) * height;\n    const from = new Point2d(left - gridLineLen, y);\n    const to = new Point2d(left, y);\n    this._line(ctx, from, to);\n\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(step.getCurrent(), left - 2 * gridLineLen, y);\n\n    step.next();\n  }\n\n  ctx.textAlign = \"right\";\n  ctx.textBaseline = \"top\";\n  const label = this.legendLabel;\n  ctx.fillText(label, right, bottom + this.margin);\n};\n\n/**\n * Redraw the filter\n */\nGraph3d.prototype._redrawFilter = function () {\n  const dataFilter = this.dataGroup.dataFilter;\n  const filter = this.frame.filter;\n  filter.innerHTML = \"\";\n\n  if (!dataFilter) {\n    filter.slider = undefined;\n    return;\n  }\n\n  const options = {\n    visible: this.showAnimationControls,\n  };\n  const slider = new Slider(filter, options);\n  filter.slider = slider;\n\n  // TODO: css here is not nice here...\n  filter.style.padding = \"10px\";\n  //this.frame.filter.style.backgroundColor = '#EFEFEF';\n\n  slider.setValues(dataFilter.values);\n  slider.setPlayInterval(this.animationInterval);\n\n  // create an event handler\n  const me = this;\n  const onchange = function () {\n    const dataFilter = me.dataGroup.dataFilter;\n    const index = slider.getIndex();\n\n    dataFilter.selectValue(index);\n    me.dataPoints = dataFilter._getDataPoints();\n\n    me.redraw();\n  };\n\n  slider.setOnChangeCallback(onchange);\n};\n\n/**\n * Redraw the slider\n */\nGraph3d.prototype._redrawSlider = function () {\n  if (this.frame.filter.slider !== undefined) {\n    this.frame.filter.slider.redraw();\n  }\n};\n\n/**\n * Redraw common information\n */\nGraph3d.prototype._redrawInfo = function () {\n  const info = this.dataGroup.getInfo();\n  if (info === undefined) return;\n\n  const ctx = this._getContext();\n\n  ctx.font = \"14px arial\"; // TODO: put in options\n  ctx.lineStyle = \"gray\";\n  ctx.fillStyle = \"gray\";\n  ctx.textAlign = \"left\";\n  ctx.textBaseline = \"top\";\n\n  const x = this.margin;\n  const y = this.margin;\n  ctx.fillText(info, x, y);\n};\n\n/**\n * Draw a line between 2d points 'from' and 'to'.\n *\n * If stroke style specified, set that as well.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point2d} from\n * @param {vis.Point2d} to\n * @param {string} [strokeStyle]\n * @private\n */\nGraph3d.prototype._line = function (ctx, from, to, strokeStyle) {\n  if (strokeStyle !== undefined) {\n    ctx.strokeStyle = strokeStyle;\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(from.x, from.y);\n  ctx.lineTo(to.x, to.y);\n  ctx.stroke();\n};\n\n/**\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point3d} point3d\n * @param {string} text\n * @param {number} armAngle\n * @param {number} [yMargin=0]\n */\nGraph3d.prototype.drawAxisLabelX = function (\n  ctx,\n  point3d,\n  text,\n  armAngle,\n  yMargin\n) {\n  if (yMargin === undefined) {\n    yMargin = 0;\n  }\n\n  const point2d = this._convert3Dto2D(point3d);\n\n  if (Math.cos(armAngle * 2) > 0) {\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"top\";\n    point2d.y += yMargin;\n  } else if (Math.sin(armAngle * 2) < 0) {\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n  } else {\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"middle\";\n  }\n\n  ctx.fillStyle = this.axisColor;\n  ctx.fillText(text, point2d.x, point2d.y);\n};\n\n/**\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point3d} point3d\n * @param {string} text\n * @param {number} armAngle\n * @param {number} [yMargin=0]\n */\nGraph3d.prototype.drawAxisLabelY = function (\n  ctx,\n  point3d,\n  text,\n  armAngle,\n  yMargin\n) {\n  if (yMargin === undefined) {\n    yMargin = 0;\n  }\n\n  const point2d = this._convert3Dto2D(point3d);\n\n  if (Math.cos(armAngle * 2) < 0) {\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"top\";\n    point2d.y += yMargin;\n  } else if (Math.sin(armAngle * 2) > 0) {\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n  } else {\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"middle\";\n  }\n\n  ctx.fillStyle = this.axisColor;\n  ctx.fillText(text, point2d.x, point2d.y);\n};\n\n/**\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point3d} point3d\n * @param {string} text\n * @param {number} [offset=0]\n */\nGraph3d.prototype.drawAxisLabelZ = function (ctx, point3d, text, offset) {\n  if (offset === undefined) {\n    offset = 0;\n  }\n\n  const point2d = this._convert3Dto2D(point3d);\n  ctx.textAlign = \"right\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillStyle = this.axisColor;\n  ctx.fillText(text, point2d.x - offset, point2d.y);\n};\n\n/**\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point3d} point3d\n * @param {string} text\n * @param {number} armAngle\n * @param {number} [yMargin=0]\n */\nGraph3d.prototype.drawAxisLabelXRotate = function (\n  ctx,\n  point3d,\n  text,\n  armAngle,\n  yMargin\n) {\n  if (yMargin === undefined) {\n    yMargin = 0;\n  }\n\n  const point2d = this._convert3Dto2D(point3d);\n  if (Math.cos(armAngle * 2) > 0) {\n    ctx.save();\n    ctx.translate(point2d.x, point2d.y);\n    ctx.rotate(-Math.PI / 2);\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(text, 0, 0);\n    ctx.restore();\n  } else if (Math.sin(armAngle * 2) < 0) {\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(text, point2d.x, point2d.y);\n  } else {\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(text, point2d.x, point2d.y);\n  }\n};\n\n/**\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point3d} point3d\n * @param {string} text\n * @param {number} armAngle\n * @param {number} [yMargin=0]\n */\nGraph3d.prototype.drawAxisLabelYRotate = function (\n  ctx,\n  point3d,\n  text,\n  armAngle,\n  yMargin\n) {\n  if (yMargin === undefined) {\n    yMargin = 0;\n  }\n\n  const point2d = this._convert3Dto2D(point3d);\n  if (Math.cos(armAngle * 2) < 0) {\n    ctx.save();\n    ctx.translate(point2d.x, point2d.y);\n    ctx.rotate(-Math.PI / 2);\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(text, 0, 0);\n    ctx.restore();\n  } else if (Math.sin(armAngle * 2) > 0) {\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(text, point2d.x, point2d.y);\n  } else {\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = this.axisColor;\n    ctx.fillText(text, point2d.x, point2d.y);\n  }\n};\n\n/**\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point3d} point3d\n * @param {string} text\n * @param {number} [offset=0]\n */\nGraph3d.prototype.drawAxisLabelZRotate = function (ctx, point3d, text, offset) {\n  if (offset === undefined) {\n    offset = 0;\n  }\n\n  const point2d = this._convert3Dto2D(point3d);\n  ctx.textAlign = \"right\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillStyle = this.axisColor;\n  ctx.fillText(text, point2d.x - offset, point2d.y);\n};\n\n/**\n \n \n/**\n * Draw a line between 2d points 'from' and 'to'.\n *\n * If stroke style specified, set that as well.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {vis.Point2d} from\n * @param {vis.Point2d} to\n * @param {string} [strokeStyle]\n * @private\n */\nGraph3d.prototype._line3d = function (ctx, from, to, strokeStyle) {\n  const from2d = this._convert3Dto2D(from);\n  const to2d = this._convert3Dto2D(to);\n\n  this._line(ctx, from2d, to2d, strokeStyle);\n};\n\n/**\n * Redraw the axis\n */\nGraph3d.prototype._redrawAxis = function () {\n  const ctx = this._getContext();\n  let from,\n    to,\n    step,\n    prettyStep,\n    text,\n    xText,\n    yText,\n    zText,\n    offset,\n    xOffset,\n    yOffset;\n\n  // TODO: get the actual rendered style of the containerElement\n  //ctx.font = this.containerElement.style.font;\n  //ctx.font = 24 / this.camera.getArmLength() + 'px arial';\n  ctx.font =\n    this.axisFontSize / this.camera.getArmLength() + \"px \" + this.axisFontType;\n\n  // calculate the length for the short grid lines\n  const gridLenX = 0.025 / this.scale.x;\n  const gridLenY = 0.025 / this.scale.y;\n  const textMargin = 5 / this.camera.getArmLength(); // px\n  const armAngle = this.camera.getArmRotation().horizontal;\n  const armVector = new Point2d(Math.cos(armAngle), Math.sin(armAngle));\n\n  const xRange = this.xRange;\n  const yRange = this.yRange;\n  const zRange = this.zRange;\n  let point3d;\n\n  // draw x-grid lines\n  ctx.lineWidth = 1;\n  prettyStep = this.defaultXStep === undefined;\n  step = new StepNumber(xRange.min, xRange.max, this.xStep, prettyStep);\n  step.start(true);\n\n  while (!step.end()) {\n    const x = step.getCurrent();\n\n    if (this.showGrid) {\n      from = new Point3d(x, yRange.min, zRange.min);\n      to = new Point3d(x, yRange.max, zRange.min);\n      this._line3d(ctx, from, to, this.gridColor);\n    } else if (this.showXAxis) {\n      from = new Point3d(x, yRange.min, zRange.min);\n      to = new Point3d(x, yRange.min + gridLenX, zRange.min);\n      this._line3d(ctx, from, to, this.axisColor);\n\n      from = new Point3d(x, yRange.max, zRange.min);\n      to = new Point3d(x, yRange.max - gridLenX, zRange.min);\n      this._line3d(ctx, from, to, this.axisColor);\n    }\n\n    if (this.showXAxis) {\n      yText = armVector.x > 0 ? yRange.min : yRange.max;\n      point3d = new Point3d(x, yText, zRange.min);\n      const msg = \"  \" + this.xValueLabel(x) + \"  \";\n      this._drawAxisLabelX.call(this, ctx, point3d, msg, armAngle, textMargin);\n    }\n\n    step.next();\n  }\n\n  // draw y-grid lines\n  ctx.lineWidth = 1;\n  prettyStep = this.defaultYStep === undefined;\n  step = new StepNumber(yRange.min, yRange.max, this.yStep, prettyStep);\n  step.start(true);\n\n  while (!step.end()) {\n    const y = step.getCurrent();\n\n    if (this.showGrid) {\n      from = new Point3d(xRange.min, y, zRange.min);\n      to = new Point3d(xRange.max, y, zRange.min);\n      this._line3d(ctx, from, to, this.gridColor);\n    } else if (this.showYAxis) {\n      from = new Point3d(xRange.min, y, zRange.min);\n      to = new Point3d(xRange.min + gridLenY, y, zRange.min);\n      this._line3d(ctx, from, to, this.axisColor);\n\n      from = new Point3d(xRange.max, y, zRange.min);\n      to = new Point3d(xRange.max - gridLenY, y, zRange.min);\n      this._line3d(ctx, from, to, this.axisColor);\n    }\n\n    if (this.showYAxis) {\n      xText = armVector.y > 0 ? xRange.min : xRange.max;\n      point3d = new Point3d(xText, y, zRange.min);\n      const msg = \"  \" + this.yValueLabel(y) + \"  \";\n      this._drawAxisLabelY.call(this, ctx, point3d, msg, armAngle, textMargin);\n    }\n\n    step.next();\n  }\n\n  // draw z-grid lines and axis\n  if (this.showZAxis) {\n    ctx.lineWidth = 1;\n    prettyStep = this.defaultZStep === undefined;\n    step = new StepNumber(zRange.min, zRange.max, this.zStep, prettyStep);\n    step.start(true);\n\n    xText = armVector.x > 0 ? xRange.min : xRange.max;\n    yText = armVector.y < 0 ? yRange.min : yRange.max;\n\n    while (!step.end()) {\n      const z = step.getCurrent();\n\n      // TODO: make z-grid lines really 3d?\n      const from3d = new Point3d(xText, yText, z);\n      const from2d = this._convert3Dto2D(from3d);\n      to = new Point2d(from2d.x - textMargin, from2d.y);\n      this._line(ctx, from2d, to, this.axisColor);\n\n      const msg = this.zValueLabel(z) + \" \";\n      this._drawAxisLabelZ.call(this, ctx, from3d, msg, 5);\n\n      step.next();\n    }\n\n    ctx.lineWidth = 1;\n    from = new Point3d(xText, yText, zRange.min);\n    to = new Point3d(xText, yText, zRange.max);\n    this._line3d(ctx, from, to, this.axisColor);\n  }\n\n  // draw x-axis\n  if (this.showXAxis) {\n    let xMin2d;\n    let xMax2d;\n    ctx.lineWidth = 1;\n\n    // line at yMin\n    xMin2d = new Point3d(xRange.min, yRange.min, zRange.min);\n    xMax2d = new Point3d(xRange.max, yRange.min, zRange.min);\n    this._line3d(ctx, xMin2d, xMax2d, this.axisColor);\n    // line at ymax\n    xMin2d = new Point3d(xRange.min, yRange.max, zRange.min);\n    xMax2d = new Point3d(xRange.max, yRange.max, zRange.min);\n    this._line3d(ctx, xMin2d, xMax2d, this.axisColor);\n  }\n\n  // draw y-axis\n  if (this.showYAxis) {\n    ctx.lineWidth = 1;\n    // line at xMin\n    from = new Point3d(xRange.min, yRange.min, zRange.min);\n    to = new Point3d(xRange.min, yRange.max, zRange.min);\n    this._line3d(ctx, from, to, this.axisColor);\n    // line at xMax\n    from = new Point3d(xRange.max, yRange.min, zRange.min);\n    to = new Point3d(xRange.max, yRange.max, zRange.min);\n    this._line3d(ctx, from, to, this.axisColor);\n  }\n\n  // draw x-label\n  const xLabel = this.xLabel;\n  if (xLabel.length > 0 && this.showXAxis) {\n    yOffset = 0.1 / this.scale.y;\n    xText = (xRange.max + 3 * xRange.min) / 4;\n    yText = armVector.x > 0 ? yRange.min - yOffset : yRange.max + yOffset;\n    text = new Point3d(xText, yText, zRange.min);\n    this.drawAxisLabelX(ctx, text, xLabel, armAngle);\n  }\n\n  // draw y-label\n  const yLabel = this.yLabel;\n  if (yLabel.length > 0 && this.showYAxis) {\n    xOffset = 0.1 / this.scale.x;\n    xText = armVector.y > 0 ? xRange.min - xOffset : xRange.max + xOffset;\n    yText = (yRange.max + 3 * yRange.min) / 4;\n    text = new Point3d(xText, yText, zRange.min);\n\n    this.drawAxisLabelY(ctx, text, yLabel, armAngle);\n  }\n\n  // draw z-label\n  const zLabel = this.zLabel;\n  if (zLabel.length > 0 && this.showZAxis) {\n    offset = 30; // pixels.  // TODO: relate to the max width of the values on the z axis?\n    xText = armVector.x > 0 ? xRange.min : xRange.max;\n    yText = armVector.y < 0 ? yRange.min : yRange.max;\n    zText = (zRange.max + 3 * zRange.min) / 4;\n    text = new Point3d(xText, yText, zText);\n\n    this.drawAxisLabelZ(ctx, text, zLabel, offset);\n  }\n};\n\n/**\n *\n * @param {vis.Point3d} point\n * @returns {*}\n * @private\n */\nGraph3d.prototype._getStrokeWidth = function (point) {\n  if (point !== undefined) {\n    if (this.showPerspective) {\n      return (1 / -point.trans.z) * this.dataColor.strokeWidth;\n    } else {\n      return (\n        -(this.eye.z / this.camera.getArmLength()) * this.dataColor.strokeWidth\n      );\n    }\n  }\n\n  return this.dataColor.strokeWidth;\n};\n\n// -----------------------------------------------------------------------------\n// Drawing primitives for the graphs\n// -----------------------------------------------------------------------------\n\n/**\n * Draw a bar element in the view with the given properties.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @param {number} xWidth\n * @param {number} yWidth\n * @param {string} color\n * @param {string} borderColor\n * @private\n */\nGraph3d.prototype._redrawBar = function (\n  ctx,\n  point,\n  xWidth,\n  yWidth,\n  color,\n  borderColor\n) {\n  let surface;\n\n  // calculate all corner points\n  const me = this;\n  const point3d = point.point;\n  const zMin = this.zRange.min;\n  const top = [\n    { point: new Point3d(point3d.x - xWidth, point3d.y - yWidth, point3d.z) },\n    { point: new Point3d(point3d.x + xWidth, point3d.y - yWidth, point3d.z) },\n    { point: new Point3d(point3d.x + xWidth, point3d.y + yWidth, point3d.z) },\n    { point: new Point3d(point3d.x - xWidth, point3d.y + yWidth, point3d.z) },\n  ];\n  const bottom = [\n    { point: new Point3d(point3d.x - xWidth, point3d.y - yWidth, zMin) },\n    { point: new Point3d(point3d.x + xWidth, point3d.y - yWidth, zMin) },\n    { point: new Point3d(point3d.x + xWidth, point3d.y + yWidth, zMin) },\n    { point: new Point3d(point3d.x - xWidth, point3d.y + yWidth, zMin) },\n  ];\n\n  // calculate screen location of the points\n  top.forEach(function (obj) {\n    obj.screen = me._convert3Dto2D(obj.point);\n  });\n  bottom.forEach(function (obj) {\n    obj.screen = me._convert3Dto2D(obj.point);\n  });\n\n  // create five sides, calculate both corner points and center points\n  const surfaces = [\n    { corners: top, center: Point3d.avg(bottom[0].point, bottom[2].point) },\n    {\n      corners: [top[0], top[1], bottom[1], bottom[0]],\n      center: Point3d.avg(bottom[1].point, bottom[0].point),\n    },\n    {\n      corners: [top[1], top[2], bottom[2], bottom[1]],\n      center: Point3d.avg(bottom[2].point, bottom[1].point),\n    },\n    {\n      corners: [top[2], top[3], bottom[3], bottom[2]],\n      center: Point3d.avg(bottom[3].point, bottom[2].point),\n    },\n    {\n      corners: [top[3], top[0], bottom[0], bottom[3]],\n      center: Point3d.avg(bottom[0].point, bottom[3].point),\n    },\n  ];\n  point.surfaces = surfaces;\n\n  // calculate the distance of each of the surface centers to the camera\n  for (let j = 0; j < surfaces.length; j++) {\n    surface = surfaces[j];\n    const transCenter = this._convertPointToTranslation(surface.center);\n    surface.dist = this.showPerspective ? transCenter.length() : -transCenter.z;\n    // TODO: this dept calculation doesn't work 100% of the cases due to perspective,\n    //     but the current solution is fast/simple and works in 99.9% of all cases\n    //     the issue is visible in example 14, with graph.setCameraPosition({horizontal: 2.97, vertical: 0.5, distance: 0.9})\n  }\n\n  // order the surfaces by their (translated) depth\n  surfaces.sort(function (a, b) {\n    const diff = b.dist - a.dist;\n    if (diff) return diff;\n\n    // if equal depth, sort the top surface last\n    if (a.corners === top) return 1;\n    if (b.corners === top) return -1;\n\n    // both are equal\n    return 0;\n  });\n\n  // draw the ordered surfaces\n  ctx.lineWidth = this._getStrokeWidth(point);\n  ctx.strokeStyle = borderColor;\n  ctx.fillStyle = color;\n  // NOTE: we start at j=2 instead of j=0 as we don't need to draw the two surfaces at the backside\n  for (let j = 2; j < surfaces.length; j++) {\n    surface = surfaces[j];\n    this._polygon(ctx, surface.corners);\n  }\n};\n\n/**\n * Draw a polygon using the passed points and fill it with the passed style and stroke.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {Array.<vis.Point3d>} points      an array of points.\n * @param {string} [fillStyle] the fill style to set\n * @param {string} [strokeStyle] the stroke style to set\n */\nGraph3d.prototype._polygon = function (ctx, points, fillStyle, strokeStyle) {\n  if (points.length < 2) {\n    return;\n  }\n\n  if (fillStyle !== undefined) {\n    ctx.fillStyle = fillStyle;\n  }\n  if (strokeStyle !== undefined) {\n    ctx.strokeStyle = strokeStyle;\n  }\n  ctx.beginPath();\n  ctx.moveTo(points[0].screen.x, points[0].screen.y);\n\n  for (let i = 1; i < points.length; ++i) {\n    const point = points[i];\n    ctx.lineTo(point.screen.x, point.screen.y);\n  }\n\n  ctx.closePath();\n  ctx.fill();\n  ctx.stroke(); // TODO: only draw stroke when strokeWidth > 0\n};\n\n/**\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @param {string} color\n * @param {string} borderColor\n * @param {number} [size=this._dotSize()]\n * @private\n */\nGraph3d.prototype._drawCircle = function (\n  ctx,\n  point,\n  color,\n  borderColor,\n  size\n) {\n  const radius = this._calcRadius(point, size);\n\n  ctx.lineWidth = this._getStrokeWidth(point);\n  ctx.strokeStyle = borderColor;\n  ctx.fillStyle = color;\n  ctx.beginPath();\n  ctx.arc(point.screen.x, point.screen.y, radius, 0, Math.PI * 2, true);\n  ctx.fill();\n  ctx.stroke();\n};\n\n/**\n * Determine the colors for the 'regular' graph styles.\n *\n * @param {object} point\n * @returns {{fill, border}}\n * @private\n */\nGraph3d.prototype._getColorsRegular = function (point) {\n  const f = (point.point.value - this.valueRange.min) * this.scale.value;\n  const color = this._colormap(f, 1);\n  const borderColor = this._colormap(f, 0.8);\n  return {\n    fill: color,\n    border: borderColor,\n  };\n};\n\n/**\n * Get the colors for the 'color' graph styles.\n * These styles are currently: 'bar-color' and 'dot-color'\n * Color may be set as a string representation of HTML color, like #ff00ff,\n * or calculated from a number, for example, distance from this point\n * The first option is useful when we have some pre-given legend, to which we have to adjust ourselves\n * The second option is useful when we are interested in automatically setting the color, from some value,\n * using some color scale\n *\n * @param {object} point\n * @returns {{fill: *, border: *}}\n * @private\n */\nGraph3d.prototype._getColorsColor = function (point) {\n  // calculate the color based on the value\n  let color, borderColor, pointStyle;\n  if (point && point.point && point.point.data && point.point.data.style) {\n    pointStyle = point.point.data.style;\n  }\n  if (\n    pointStyle &&\n    typeof pointStyle === \"object\" &&\n    pointStyle.fill &&\n    pointStyle.stroke\n  ) {\n    return {\n      fill: pointStyle.fill,\n      border: pointStyle.stroke,\n    };\n  }\n\n  if (typeof point.point.value === \"string\") {\n    color = point.point.value;\n    borderColor = point.point.value;\n  } else {\n    const f = (point.point.value - this.valueRange.min) * this.scale.value;\n    color = this._colormap(f, 1);\n    borderColor = this._colormap(f, 0.8);\n  }\n  return {\n    fill: color,\n    border: borderColor,\n  };\n};\n\n/**\n * Get the colors for the 'size' graph styles.\n * These styles are currently: 'bar-size' and 'dot-size'\n *\n * @returns {{fill: *, border: (string|colorOptions.stroke|{string, undefined}|string|colorOptions.stroke|{string}|*)}}\n * @private\n */\nGraph3d.prototype._getColorsSize = function () {\n  return {\n    fill: this.dataColor.fill,\n    border: this.dataColor.stroke,\n  };\n};\n\n/**\n * Determine the color corresponding to a given value on the color scale.\n *\n * @param {number} [x] the data value to be mapped running from 0 to 1\n * @param {number} [v] scale factor between 0 and 1 for the color brightness\n * @returns {string}\n * @private\n */\nGraph3d.prototype._colormap = function (x, v = 1) {\n  let r, g, b, a;\n  const colormap = this.colormap;\n  if (Array.isArray(colormap)) {\n    const maxIndex = colormap.length - 1;\n    const startIndex = Math.max(Math.floor(x * maxIndex), 0);\n    const endIndex = Math.min(startIndex + 1, maxIndex);\n    const innerRatio = x * maxIndex - startIndex;\n    const min = colormap[startIndex];\n    const max = colormap[endIndex];\n    r = min.r + innerRatio * (max.r - min.r);\n    g = min.g + innerRatio * (max.g - min.g);\n    b = min.b + innerRatio * (max.b - min.b);\n  } else if (typeof colormap === \"function\") {\n    ({ r, g, b, a } = colormap(x));\n  } else {\n    const hue = (1 - x) * 240;\n    ({ r, g, b } = util.HSVToRGB(hue / 360, 1, 1));\n  }\n  if (typeof a === \"number\" && !Number.isNaN(a)) {\n    return `RGBA(${Math.round(r * v)}, ${Math.round(g * v)}, ${Math.round(\n      b * v\n    )}, ${a})`;\n  } else {\n    return `RGB(${Math.round(r * v)}, ${Math.round(g * v)}, ${Math.round(\n      b * v\n    )})`;\n  }\n};\n\n/**\n * Determine the size of a point on-screen, as determined by the\n * distance to the camera.\n *\n * @param {object} point\n * @param {number} [size=this._dotSize()] the size that needs to be translated to screen coordinates.\n *             optional; if not passed, use the default point size.\n * @returns {number}\n * @private\n */\nGraph3d.prototype._calcRadius = function (point, size) {\n  if (size === undefined) {\n    size = this._dotSize();\n  }\n\n  let radius;\n  if (this.showPerspective) {\n    radius = size / -point.trans.z;\n  } else {\n    radius = size * -(this.eye.z / this.camera.getArmLength());\n  }\n  if (radius < 0) {\n    radius = 0;\n  }\n\n  return radius;\n};\n\n// -----------------------------------------------------------------------------\n// Methods for drawing points per graph style.\n// -----------------------------------------------------------------------------\n\n/**\n * Draw single datapoint for graph style 'bar'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawBarGraphPoint = function (ctx, point) {\n  const xWidth = this.xBarWidth / 2;\n  const yWidth = this.yBarWidth / 2;\n  const colors = this._getColorsRegular(point);\n\n  this._redrawBar(ctx, point, xWidth, yWidth, colors.fill, colors.border);\n};\n\n/**\n * Draw single datapoint for graph style 'bar-color'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawBarColorGraphPoint = function (ctx, point) {\n  const xWidth = this.xBarWidth / 2;\n  const yWidth = this.yBarWidth / 2;\n  const colors = this._getColorsColor(point);\n\n  this._redrawBar(ctx, point, xWidth, yWidth, colors.fill, colors.border);\n};\n\n/**\n * Draw single datapoint for graph style 'bar-size'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawBarSizeGraphPoint = function (ctx, point) {\n  // calculate size for the bar\n  const fraction =\n    (point.point.value - this.valueRange.min) / this.valueRange.range();\n  const xWidth = (this.xBarWidth / 2) * (fraction * 0.8 + 0.2);\n  const yWidth = (this.yBarWidth / 2) * (fraction * 0.8 + 0.2);\n\n  const colors = this._getColorsSize();\n\n  this._redrawBar(ctx, point, xWidth, yWidth, colors.fill, colors.border);\n};\n\n/**\n * Draw single datapoint for graph style 'dot'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawDotGraphPoint = function (ctx, point) {\n  const colors = this._getColorsRegular(point);\n\n  this._drawCircle(ctx, point, colors.fill, colors.border);\n};\n\n/**\n * Draw single datapoint for graph style 'dot-line'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawDotLineGraphPoint = function (ctx, point) {\n  // draw a vertical line from the XY-plane to the graph value\n  const from = this._convert3Dto2D(point.bottom);\n  ctx.lineWidth = 1;\n  this._line(ctx, from, point.screen, this.gridColor);\n\n  this._redrawDotGraphPoint(ctx, point);\n};\n\n/**\n * Draw single datapoint for graph style 'dot-color'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawDotColorGraphPoint = function (ctx, point) {\n  const colors = this._getColorsColor(point);\n\n  this._drawCircle(ctx, point, colors.fill, colors.border);\n};\n\n/**\n * Draw single datapoint for graph style 'dot-size'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawDotSizeGraphPoint = function (ctx, point) {\n  const dotSize = this._dotSize();\n  const fraction =\n    (point.point.value - this.valueRange.min) / this.valueRange.range();\n\n  const sizeMin = dotSize * this.dotSizeMinFraction;\n  const sizeRange = dotSize * this.dotSizeMaxFraction - sizeMin;\n  const size = sizeMin + sizeRange * fraction;\n\n  const colors = this._getColorsSize();\n\n  this._drawCircle(ctx, point, colors.fill, colors.border, size);\n};\n\n/**\n * Draw single datapoint for graph style 'surface'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawSurfaceGraphPoint = function (ctx, point) {\n  const right = point.pointRight;\n  const top = point.pointTop;\n  const cross = point.pointCross;\n\n  if (\n    point === undefined ||\n    right === undefined ||\n    top === undefined ||\n    cross === undefined\n  ) {\n    return;\n  }\n\n  let topSideVisible = true;\n  let fillStyle;\n  let strokeStyle;\n  let cosViewAngle;\n\n  if (this.showGrayBottom || this.showShadow) {\n    // calculate the cross product of the two vectors from center\n    // to left and right, in order to know whether we are looking at the\n    // bottom or at the top side. We can also use the cross product\n    // for calculating light intensity\n    const aDiff = Point3d.subtract(cross.trans, point.trans);\n    const bDiff = Point3d.subtract(top.trans, right.trans);\n    const surfaceNormal = Point3d.crossProduct(aDiff, bDiff);\n\n    if (this.showPerspective) {\n      const surfacePosition = Point3d.avg(\n        Point3d.avg(point.trans, cross.trans),\n        Point3d.avg(right.trans, top.trans)\n      );\n      // This corresponds to diffuse lighting with light source at (0, 0, 0).\n      // More generally, we would need `surfacePosition - lightPosition`:\n      cosViewAngle = -Point3d.dotProduct(\n        surfaceNormal.normalize(),\n        surfacePosition.normalize()\n      );\n    } else {\n      cosViewAngle = surfaceNormal.z / surfaceNormal.length();\n    }\n    topSideVisible = cosViewAngle > 0;\n  }\n\n  if (topSideVisible || !this.showGrayBottom) {\n    const vAvg =\n      (point.point.value +\n        right.point.value +\n        top.point.value +\n        cross.point.value) /\n      4;\n    const ratio = (vAvg - this.valueRange.min) * this.scale.value;\n    // lighting factor. TODO: let user specify lighting model as function(?)\n    const v = this.showShadow ? (1 + cosViewAngle) / 2 : 1;\n    fillStyle = this._colormap(ratio, v);\n  } else {\n    fillStyle = \"gray\";\n  }\n\n  if (this.showSurfaceGrid) {\n    strokeStyle = this.axisColor; // TODO: should be customizable\n  } else {\n    strokeStyle = fillStyle;\n  }\n\n  ctx.lineWidth = this._getStrokeWidth(point);\n  // TODO: only draw stroke when strokeWidth > 0\n\n  const points = [point, right, cross, top];\n  this._polygon(ctx, points, fillStyle, strokeStyle);\n};\n\n/**\n * Helper method for _redrawGridGraphPoint()\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} from\n * @param {object} to\n * @private\n */\nGraph3d.prototype._drawGridLine = function (ctx, from, to) {\n  if (from === undefined || to === undefined) {\n    return;\n  }\n\n  const vAvg = (from.point.value + to.point.value) / 2;\n  const f = (vAvg - this.valueRange.min) * this.scale.value;\n\n  ctx.lineWidth = this._getStrokeWidth(from) * 2;\n  ctx.strokeStyle = this._colormap(f, 1);\n  this._line(ctx, from.screen, to.screen);\n};\n\n/**\n * Draw single datapoint for graph style 'Grid'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawGridGraphPoint = function (ctx, point) {\n  this._drawGridLine(ctx, point, point.pointRight);\n  this._drawGridLine(ctx, point, point.pointTop);\n};\n\n/**\n * Draw single datapoint for graph style 'line'.\n *\n * @param {CanvasRenderingContext2D} ctx\n * @param {object} point\n * @private\n */\nGraph3d.prototype._redrawLineGraphPoint = function (ctx, point) {\n  if (point.pointNext === undefined) {\n    return;\n  }\n\n  ctx.lineWidth = this._getStrokeWidth(point);\n  ctx.strokeStyle = this.dataColor.stroke;\n\n  this._line(ctx, point.screen, point.pointNext.screen);\n};\n\n/**\n * Draw all datapoints for currently selected graph style.\n *\n */\nGraph3d.prototype._redrawDataGraph = function () {\n  const ctx = this._getContext();\n  let i;\n\n  if (this.dataPoints === undefined || this.dataPoints.length <= 0) return; // TODO: throw exception?\n\n  this._calcTranslations(this.dataPoints);\n\n  for (i = 0; i < this.dataPoints.length; i++) {\n    const point = this.dataPoints[i];\n\n    // Using call() ensures that the correct context is used\n    this._pointDrawingMethod.call(this, ctx, point);\n  }\n};\n\n// -----------------------------------------------------------------------------\n// End methods for drawing points per graph style.\n// -----------------------------------------------------------------------------\n\n/**\n * Store startX, startY and startOffset for mouse operations\n *\n * @param {Event}     event     The event that occurred\n */\nGraph3d.prototype._storeMousePosition = function (event) {\n  // get mouse position (different code for IE and all other browsers)\n  this.startMouseX = getMouseX(event);\n  this.startMouseY = getMouseY(event);\n\n  this._startCameraOffset = this.camera.getOffset();\n};\n\n/**\n * Start a moving operation inside the provided parent element\n *\n * @param {Event}     event     The event that occurred (required for\n *                  retrieving the  mouse position)\n */\nGraph3d.prototype._onMouseDown = function (event) {\n  event = event || window.event;\n\n  // check if mouse is still down (may be up when focus is lost for example\n  // in an iframe)\n  if (this.leftButtonDown) {\n    this._onMouseUp(event);\n  }\n\n  // only react on left mouse button down\n  this.leftButtonDown = event.which ? event.which === 1 : event.button === 1;\n  if (!this.leftButtonDown && !this.touchDown) return;\n\n  this._storeMousePosition(event);\n\n  this.startStart = new Date(this.start);\n  this.startEnd = new Date(this.end);\n  this.startArmRotation = this.camera.getArmRotation();\n\n  this.frame.style.cursor = \"move\";\n\n  // add event listeners to handle moving the contents\n  // we store the function onmousemove and onmouseup in the graph, so we can\n  // remove the eventlisteners lateron in the function mouseUp()\n  const me = this;\n  this.onmousemove = function (event) {\n    me._onMouseMove(event);\n  };\n  this.onmouseup = function (event) {\n    me._onMouseUp(event);\n  };\n  document.addEventListener(\"mousemove\", me.onmousemove);\n  document.addEventListener(\"mouseup\", me.onmouseup);\n  util.preventDefault(event);\n};\n\n/**\n * Perform moving operating.\n * This function activated from within the funcion Graph.mouseDown().\n *\n * @param {Event}   event  Well, eehh, the event\n */\nGraph3d.prototype._onMouseMove = function (event) {\n  this.moving = true;\n  event = event || window.event;\n\n  // calculate change in mouse position\n  const diffX = parseFloat(getMouseX(event)) - this.startMouseX;\n  const diffY = parseFloat(getMouseY(event)) - this.startMouseY;\n\n  // move with ctrl or rotate by other\n  if (event && event.ctrlKey === true) {\n    // calculate change in mouse position\n    const scaleX = this.frame.clientWidth * 0.5;\n    const scaleY = this.frame.clientHeight * 0.5;\n\n    const offXNew =\n      (this._startCameraOffset.x || 0) -\n      (diffX / scaleX) * this.camera.armLength * 0.8;\n    const offYNew =\n      (this._startCameraOffset.y || 0) +\n      (diffY / scaleY) * this.camera.armLength * 0.8;\n\n    this.camera.setOffset(offXNew, offYNew);\n    this._storeMousePosition(event);\n  } else {\n    let horizontalNew = this.startArmRotation.horizontal + diffX / 200;\n    let verticalNew = this.startArmRotation.vertical + diffY / 200;\n\n    const snapAngle = 4; // degrees\n    const snapValue = Math.sin((snapAngle / 360) * 2 * Math.PI);\n\n    // snap horizontally to nice angles at 0pi, 0.5pi, 1pi, 1.5pi, etc...\n    // the -0.001 is to take care that the vertical axis is always drawn at the left front corner\n    if (Math.abs(Math.sin(horizontalNew)) < snapValue) {\n      horizontalNew = Math.round(horizontalNew / Math.PI) * Math.PI - 0.001;\n    }\n    if (Math.abs(Math.cos(horizontalNew)) < snapValue) {\n      horizontalNew =\n        (Math.round(horizontalNew / Math.PI - 0.5) + 0.5) * Math.PI - 0.001;\n    }\n\n    // snap vertically to nice angles\n    if (Math.abs(Math.sin(verticalNew)) < snapValue) {\n      verticalNew = Math.round(verticalNew / Math.PI) * Math.PI;\n    }\n    if (Math.abs(Math.cos(verticalNew)) < snapValue) {\n      verticalNew = (Math.round(verticalNew / Math.PI - 0.5) + 0.5) * Math.PI;\n    }\n    this.camera.setArmRotation(horizontalNew, verticalNew);\n  }\n\n  this.redraw();\n\n  // fire a cameraPositionChange event\n  const parameters = this.getCameraPosition();\n  this.emit(\"cameraPositionChange\", parameters);\n\n  util.preventDefault(event);\n};\n\n/**\n * Stop moving operating.\n * This function activated from within the funcion Graph.mouseDown().\n *\n * @param {Event}  event   The event\n */\nGraph3d.prototype._onMouseUp = function (event) {\n  this.frame.style.cursor = \"auto\";\n  this.leftButtonDown = false;\n\n  // remove event listeners here\n  util.removeEventListener(document, \"mousemove\", this.onmousemove);\n  util.removeEventListener(document, \"mouseup\", this.onmouseup);\n  util.preventDefault(event);\n};\n\n/**\n * @param {Event}  event   The event\n */\nGraph3d.prototype._onClick = function (event) {\n  // NOTE: onclick_callback is deprecated and may be removed in a future version.\n  if (!this.onclick_callback && !this.hasListeners(\"click\")) return;\n  if (!this.moving) {\n    const boundingRect = this.frame.getBoundingClientRect();\n    const mouseX = getMouseX(event) - boundingRect.left;\n    const mouseY = getMouseY(event) - boundingRect.top;\n    const dataPoint = this._dataPointFromXY(mouseX, mouseY);\n    if (dataPoint) {\n      if (this.onclick_callback) this.onclick_callback(dataPoint.point.data);\n      this.emit(\"click\", dataPoint.point.data);\n    }\n  } else {\n    // disable onclick callback, if it came immediately after rotate/pan\n    this.moving = false;\n  }\n  util.preventDefault(event);\n};\n\n/**\n * After having moved the mouse, a tooltip should pop up when the mouse is resting on a data point\n *\n * @param {Event}  event   A mouse move event\n */\nGraph3d.prototype._onTooltip = function (event) {\n  const delay = this.tooltipDelay; // ms\n  const boundingRect = this.frame.getBoundingClientRect();\n  const mouseX = getMouseX(event) - boundingRect.left;\n  const mouseY = getMouseY(event) - boundingRect.top;\n\n  if (!this.showTooltip) {\n    return;\n  }\n\n  if (this.tooltipTimeout) {\n    clearTimeout(this.tooltipTimeout);\n  }\n\n  // (delayed) display of a tooltip only if no mouse button is down\n  if (this.leftButtonDown) {\n    this._hideTooltip();\n    return;\n  }\n\n  if (this.tooltip && this.tooltip.dataPoint) {\n    // tooltip is currently visible\n    const dataPoint = this._dataPointFromXY(mouseX, mouseY);\n    if (dataPoint !== this.tooltip.dataPoint) {\n      // datapoint changed\n      if (dataPoint) {\n        this._showTooltip(dataPoint);\n      } else {\n        this._hideTooltip();\n      }\n    }\n  } else {\n    // tooltip is currently not visible\n    const me = this;\n    this.tooltipTimeout = setTimeout(function () {\n      me.tooltipTimeout = null;\n\n      // show a tooltip if we have a data point\n      const dataPoint = me._dataPointFromXY(mouseX, mouseY);\n      if (dataPoint) {\n        me._showTooltip(dataPoint);\n      }\n    }, delay);\n  }\n};\n\n/**\n * Event handler for touchstart event on mobile devices\n *\n * @param {Event}  event   The event\n */\nGraph3d.prototype._onTouchStart = function (event) {\n  this.touchDown = true;\n\n  const me = this;\n  this.ontouchmove = function (event) {\n    me._onTouchMove(event);\n  };\n  this.ontouchend = function (event) {\n    me._onTouchEnd(event);\n  };\n  document.addEventListener(\"touchmove\", me.ontouchmove);\n  document.addEventListener(\"touchend\", me.ontouchend);\n\n  this._onMouseDown(event);\n};\n\n/**\n * Event handler for touchmove event on mobile devices\n *\n * @param {Event}  event   The event\n */\nGraph3d.prototype._onTouchMove = function (event) {\n  this._onMouseMove(event);\n};\n\n/**\n * Event handler for touchend event on mobile devices\n *\n * @param {Event}  event   The event\n */\nGraph3d.prototype._onTouchEnd = function (event) {\n  this.touchDown = false;\n\n  util.removeEventListener(document, \"touchmove\", this.ontouchmove);\n  util.removeEventListener(document, \"touchend\", this.ontouchend);\n\n  this._onMouseUp(event);\n};\n\n/**\n * Event handler for mouse wheel event, used to zoom the graph\n * Code from http://adomas.org/javascript-mouse-wheel/\n *\n * @param {Event}  event   The event\n */\nGraph3d.prototype._onWheel = function (event) {\n  if (!event) /* For IE. */ event = window.event;\n  if (this.zoomable && (!this.ctrlToZoom || event.ctrlKey)) {\n    // retrieve delta\n    let delta = 0;\n    if (event.wheelDelta) {\n      /* IE/Opera. */\n      delta = event.wheelDelta / 120;\n    } else if (event.detail) {\n      /* Mozilla case. */\n      // In Mozilla, sign of delta is different than in IE.\n      // Also, delta is multiple of 3.\n      delta = -event.detail / 3;\n    }\n\n    // If delta is nonzero, handle it.\n    // Basically, delta is now positive if wheel was scrolled up,\n    // and negative, if wheel was scrolled down.\n    if (delta) {\n      const oldLength = this.camera.getArmLength();\n      const newLength = oldLength * (1 - delta / 10);\n\n      this.camera.setArmLength(newLength);\n      this.redraw();\n\n      this._hideTooltip();\n    }\n\n    // fire a cameraPositionChange event\n    const parameters = this.getCameraPosition();\n    this.emit(\"cameraPositionChange\", parameters);\n\n    // Prevent default actions caused by mouse wheel.\n    // That might be ugly, but we handle scrolls somehow\n    // anyway, so don't bother here..\n    util.preventDefault(event);\n  }\n};\n\n/**\n * Test whether a point lies inside given 2D triangle\n *\n * @param   {vis.Point2d}   point\n * @param   {vis.Point2d[]} triangle\n * @returns {boolean}   true if given point lies inside or on the edge of the\n *                      triangle, false otherwise\n * @private\n */\nGraph3d.prototype._insideTriangle = function (point, triangle) {\n  const a = triangle[0],\n    b = triangle[1],\n    c = triangle[2];\n\n  /**\n   *\n   * @param {number} x\n   * @returns {number}\n   */\n  function sign(x) {\n    return x > 0 ? 1 : x < 0 ? -1 : 0;\n  }\n\n  const as = sign(\n    (b.x - a.x) * (point.y - a.y) - (b.y - a.y) * (point.x - a.x)\n  );\n  const bs = sign(\n    (c.x - b.x) * (point.y - b.y) - (c.y - b.y) * (point.x - b.x)\n  );\n  const cs = sign(\n    (a.x - c.x) * (point.y - c.y) - (a.y - c.y) * (point.x - c.x)\n  );\n\n  // each of the three signs must be either equal to each other or zero\n  return (\n    (as == 0 || bs == 0 || as == bs) &&\n    (bs == 0 || cs == 0 || bs == cs) &&\n    (as == 0 || cs == 0 || as == cs)\n  );\n};\n\n/**\n * Find a data point close to given screen position (x, y)\n *\n * @param   {number} x\n * @param   {number} y\n * @returns {object | null} The closest data point or null if not close to any\n *                          data point\n * @private\n */\nGraph3d.prototype._dataPointFromXY = function (x, y) {\n  const distMax = 100; // px\n  const center = new Point2d(x, y);\n  let i,\n    dataPoint = null,\n    closestDataPoint = null,\n    closestDist = null;\n\n  if (\n    this.style === Graph3d.STYLE.BAR ||\n    this.style === Graph3d.STYLE.BARCOLOR ||\n    this.style === Graph3d.STYLE.BARSIZE\n  ) {\n    // the data points are ordered from far away to closest\n    for (i = this.dataPoints.length - 1; i >= 0; i--) {\n      dataPoint = this.dataPoints[i];\n      const surfaces = dataPoint.surfaces;\n      if (surfaces) {\n        for (let s = surfaces.length - 1; s >= 0; s--) {\n          // split each surface in two triangles, and see if the center point is inside one of these\n          const surface = surfaces[s];\n          const corners = surface.corners;\n          const triangle1 = [\n            corners[0].screen,\n            corners[1].screen,\n            corners[2].screen,\n          ];\n          const triangle2 = [\n            corners[2].screen,\n            corners[3].screen,\n            corners[0].screen,\n          ];\n          if (\n            this._insideTriangle(center, triangle1) ||\n            this._insideTriangle(center, triangle2)\n          ) {\n            // return immediately at the first hit\n            return dataPoint;\n          }\n        }\n      }\n    }\n  } else {\n    // find the closest data point, using distance to the center of the point on 2d screen\n    for (i = 0; i < this.dataPoints.length; i++) {\n      dataPoint = this.dataPoints[i];\n      const point = dataPoint.screen;\n      if (point) {\n        const distX = Math.abs(x - point.x);\n        const distY = Math.abs(y - point.y);\n        const dist = Math.sqrt(distX * distX + distY * distY);\n\n        if ((closestDist === null || dist < closestDist) && dist < distMax) {\n          closestDist = dist;\n          closestDataPoint = dataPoint;\n        }\n      }\n    }\n  }\n\n  return closestDataPoint;\n};\n\n/**\n * Determine if the given style has bars\n *\n * @param   {number} style the style to check\n * @returns {boolean} true if bar style, false otherwise\n */\nGraph3d.prototype.hasBars = function (style) {\n  return (\n    style == Graph3d.STYLE.BAR ||\n    style == Graph3d.STYLE.BARCOLOR ||\n    style == Graph3d.STYLE.BARSIZE\n  );\n};\n\n/**\n * Display a tooltip for given data point\n *\n * @param {object} dataPoint\n * @private\n */\nGraph3d.prototype._showTooltip = function (dataPoint) {\n  let content, line, dot;\n\n  if (!this.tooltip) {\n    content = document.createElement(\"div\");\n    Object.assign(content.style, {}, this.tooltipStyle.content);\n    content.style.position = \"absolute\";\n\n    line = document.createElement(\"div\");\n    Object.assign(line.style, {}, this.tooltipStyle.line);\n    line.style.position = \"absolute\";\n\n    dot = document.createElement(\"div\");\n    Object.assign(dot.style, {}, this.tooltipStyle.dot);\n    dot.style.position = \"absolute\";\n\n    this.tooltip = {\n      dataPoint: null,\n      dom: {\n        content: content,\n        line: line,\n        dot: dot,\n      },\n    };\n  } else {\n    content = this.tooltip.dom.content;\n    line = this.tooltip.dom.line;\n    dot = this.tooltip.dom.dot;\n  }\n\n  this._hideTooltip();\n\n  this.tooltip.dataPoint = dataPoint;\n  if (typeof this.showTooltip === \"function\") {\n    content.innerHTML = this.showTooltip(dataPoint.point);\n  } else {\n    content.innerHTML =\n      \"<table>\" +\n      \"<tr><td>\" +\n      this.xLabel +\n      \":</td><td>\" +\n      dataPoint.point.x +\n      \"</td></tr>\" +\n      \"<tr><td>\" +\n      this.yLabel +\n      \":</td><td>\" +\n      dataPoint.point.y +\n      \"</td></tr>\" +\n      \"<tr><td>\" +\n      this.zLabel +\n      \":</td><td>\" +\n      dataPoint.point.z +\n      \"</td></tr>\" +\n      \"</table>\";\n  }\n\n  content.style.left = \"0\";\n  content.style.top = \"0\";\n  this.frame.appendChild(content);\n  this.frame.appendChild(line);\n  this.frame.appendChild(dot);\n\n  // calculate sizes\n  const contentWidth = content.offsetWidth;\n  const contentHeight = content.offsetHeight;\n  const lineHeight = line.offsetHeight;\n  const dotWidth = dot.offsetWidth;\n  const dotHeight = dot.offsetHeight;\n\n  let left = dataPoint.screen.x - contentWidth / 2;\n  left = Math.min(\n    Math.max(left, 10),\n    this.frame.clientWidth - 10 - contentWidth\n  );\n\n  line.style.left = dataPoint.screen.x + \"px\";\n  line.style.top = dataPoint.screen.y - lineHeight + \"px\";\n  content.style.left = left + \"px\";\n  content.style.top = dataPoint.screen.y - lineHeight - contentHeight + \"px\";\n  dot.style.left = dataPoint.screen.x - dotWidth / 2 + \"px\";\n  dot.style.top = dataPoint.screen.y - dotHeight / 2 + \"px\";\n};\n\n/**\n * Hide the tooltip when displayed\n *\n * @private\n */\nGraph3d.prototype._hideTooltip = function () {\n  if (this.tooltip) {\n    this.tooltip.dataPoint = null;\n\n    for (const prop in this.tooltip.dom) {\n      if (Object.prototype.hasOwnProperty.call(this.tooltip.dom, prop)) {\n        const elem = this.tooltip.dom[prop];\n        if (elem && elem.parentNode) {\n          elem.parentNode.removeChild(elem);\n        }\n      }\n    }\n  }\n};\n\n/**--------------------------------------------------------------------------**/\n\n/**\n * Get the horizontal mouse position from a mouse event\n *\n * @param   {Event}  event\n * @returns {number} mouse x\n */\nfunction getMouseX(event) {\n  if (\"clientX\" in event) return event.clientX;\n  return (event.targetTouches[0] && event.targetTouches[0].clientX) || 0;\n}\n\n/**\n * Get the vertical mouse position from a mouse event\n *\n * @param   {Event}  event\n * @returns {number} mouse y\n */\nfunction getMouseY(event) {\n  if (\"clientY\" in event) return event.clientY;\n  return (event.targetTouches[0] && event.targetTouches[0].clientY) || 0;\n}\n\n// -----------------------------------------------------------------------------\n//  Public methods for specific settings\n// -----------------------------------------------------------------------------\n\n/**\n * Set the rotation and distance of the camera\n *\n * @param {object}  pos            An object with the camera position\n * @param {number} [pos.horizontal] The horizontal rotation, between 0 and 2*PI.\n *                                 Optional, can be left undefined.\n * @param {number} [pos.vertical]  The vertical rotation, between 0 and 0.5*PI.\n *                                 if vertical=0.5*PI, the graph is shown from\n *                                 the top. Optional, can be left undefined.\n * @param {number} [pos.distance]  The (normalized) distance of the camera to the\n *                                 center of the graph, a value between 0.71 and\n *                                 5.0. Optional, can be left undefined.\n */\nGraph3d.prototype.setCameraPosition = function (pos) {\n  setCameraPosition(pos, this);\n  this.redraw();\n};\n\n/**\n * Set a new size for the graph\n *\n * @param {string} width  Width in pixels or percentage (for example '800px'\n *                        or '50%')\n * @param {string} height Height in pixels or percentage  (for example '400px'\n *                        or '30%')\n */\nGraph3d.prototype.setSize = function (width, height) {\n  this._setSize(width, height);\n  this.redraw();\n};\n\n// -----------------------------------------------------------------------------\n//  End public methods for specific settings\n// -----------------------------------------------------------------------------\n\nexport default Graph3d;\n"],"names":["Point3d","x","y","z","this","undefined","subtract","a","b","sub","add","sum","avg","scalarProduct","p","c","dotProduct","crossProduct","crossproduct","prototype","length","Math","sqrt","normalize","Slider","container","options","Error","visible","frame","document","createElement","style","width","position","appendChild","prev","type","value","play","next","bar","border","height","borderRadius","MozBorderRadius","backgroundColor","slide","margin","left","me","onmousedown","event","_onMouseDown","onclick","togglePlay","onChangeCallback","values","index","playTimeout","playInterval","playLoop","StepNumber","start","end","step","prettyStep","_start","_end","_step","precision","_current","setRange","getIndex","setIndex","playNext","Date","diff","interval","max","setTimeout","stop","clearInterval","setOnChangeCallback","callback","setPlayInterval","getPlayInterval","setPlayLoop","doLoop","onChange","redraw","top","clientHeight","offsetHeight","clientWidth","indexToLeft","setValues","get","which","button","startClientX","clientX","startSlideX","parseFloat","cursor","onmousemove","_onMouseMove","onmouseup","_onMouseUp","addEventListener","util","preventDefault","leftToIndex","round","removeEventListener","isNumeric","n","isNaN","isFinite","setStep","calculatePrettyStep","log10","log","LN10","step1","pow","step2","step5","abs","getCurrent","toPrecision","getStep","checkFirst","Camera","armLocation","armRotation","horizontal","vertical","armLength","cameraOffset","offsetMultiplier","cameraLocation","cameraRotation","PI","calculateCameraOrientation","setOffset","sign","mul","getOffset","setArmLocation","setArmRotation","getArmRotation","rot","setArmLength","getArmLength","getCameraLocation","getCameraRotation","sin","cos","xa","za","dx","dy","STYLE","BAR","BARCOLOR","BARSIZE","DOT","DOTLINE","DOTCOLOR","DOTSIZE","GRID","LINE","SURFACE","STYLENAME","dot","line","grid","surface","OPTIONKEYS","PREFIXEDOPTIONKEYS","DEFAULTS","isEmpty","obj","prop","Object","hasOwnProperty","call","prefixFieldName","prefix","fieldName","str","charAt","toUpperCase","slice","forceCopy","src","dst","fields","srcKey","dstKey","i","safeCopy","setSpecialSettings","fill","stroke","strokeWidth","borderColor","borderWidth","borderStyle","setBackgroundColor","dataColor","setDataColor","styleNumber","styleName","number","getStyleNumberByName","valid","checkStyleNumber","setStyle","surfaceColors","console","warn","colormap","rgbColors","Array","isArray","parseColorArray","parseColorObject","hue","reverse","setSurfaceColor","setColormap","showLegend","isLegendGraphStyle","setShowLegend","setCameraPosition","cameraPosition","tooltip","showTooltip","onclick_callback","tooltipStyle","selectiveDeepExtend","map","colorCode","isValidHex","hexToRGB","hues","saturation","brightness","colorStops","hueStep","push","HSVToRGB","camPos","camera","distance","string","bool","object","array","colorOptions","__type__","allOptions","animationAutoStart","boolean","animationInterval","animationPreload","axisColor","axisFontSize","axisFontType","xBarWidth","yBarWidth","zoomable","ctrlToZoom","xCenter","yCenter","function","dotSizeMinFraction","dotSizeMaxFraction","dotSizeRatio","filterLabel","gridColor","keepAspectRatio","xLabel","yLabel","zLabel","legendLabel","xMin","yMin","zMin","xMax","yMax","zMax","showAnimationControls","showGrayBottom","showGrid","showPerspective","showShadow","showSurfaceGrid","showXAxis","showYAxis","showZAxis","rotateAxisLabels","xStep","yStep","zStep","tooltipDelay","content","color","background","boxShadow","padding","borderLeft","pointerEvents","xValueLabel","yValueLabel","zValueLabel","valueMax","valueMin","verticalRatio","Range","min","adjust","combine","range","expand","val","newMin","newMax","center","Filter","dataGroup","column","graph","getDistinctValues","selectValue","dataPoints","loaded","onLoadCallback","loadInBackground","DataGroup","dataTable","isLoaded","getLoadedProgress","len","getLabel","getColumn","getSelectedValue","getValues","getValue","_getDataPoints","f","dataView","DataView","getDataSet","filter","item","setOnLoadCallback","progress","innerHTML","bottom","removeChild","initializeData","graph3d","rawData","data","DataSet","dataSet","off","_onChange","setData","on","colX","colY","colZ","withBars","hasBars","defaultXBarWidth","getSmallestDifference","defaultYBarWidth","_initializeRange","colValue","valueRange","getColumnRange","_setRangeDefaults","defaultValueMin","defaultValueMax","zRange","table","getDataTable","dataFilter","_collectRangeSettings","indexOf","upper","barWidth","range_label","step_label","settings","sort","smallest_diff","getNumberOfRows","defaultMin","defaultMax","getDataPoints","point","trans","screen","initDataAsMatrix","dataX","dataY","dataMatrix","xIndex","yIndex","pointRight","pointTop","pointCross","getInfo","reload","pointNext","Graph3d","autoByDefault","SyntaxError","containerElement","create","eye","setDefaults","setOptions","getMouseX","targetTouches","getMouseY","clientY","v","Emitter","_setScale","scale","xRange","yRange","zCenter","_convert3Dto2D","point3d","translation","_convertPointToTranslation","_convertTranslationToScreen","ax","ay","az","cx","cy","cz","sinTx","cosTx","sinTy","cosTy","sinTz","cosTz","ex","ey","ez","dz","bx","by","Point2d","currentXCenter","canvas","currentYCenter","_calcTranslations","points","transBottom","dist","_initializeRanges","dg","hasChildNodes","firstChild","overflow","noCanvas","fontWeight","_onTouchStart","_onWheel","_onTooltip","_onClick","_setSize","_resizeCanvas","animationStart","slider","animationStop","_resizeCenter","getCameraPosition","pos","_readData","_redrawFilter","Validator","validate","error","VALIDATOR_PRINT_STYLE","setPointDrawingMethod","setAxisLabelMethod","method","_redrawBarGraphPoint","_redrawBarColorGraphPoint","_redrawBarSizeGraphPoint","_redrawDotGraphPoint","_redrawDotLineGraphPoint","_redrawDotColorGraphPoint","_redrawDotSizeGraphPoint","_redrawSurfaceGraphPoint","_redrawGridGraphPoint","_redrawLineGraphPoint","_pointDrawingMethod","_drawAxisLabelX","drawAxisLabelXRotate","_drawAxisLabelY","drawAxisLabelYRotate","_drawAxisLabelZ","drawAxisLabelZRotate","drawAxisLabelX","drawAxisLabelY","drawAxisLabelZ","_redrawSlider","_redrawClear","_redrawAxis","_redrawDataGraph","_redrawInfo","_redrawLegend","_getContext","ctx","getContext","lineJoin","lineCap","clearRect","_dotSize","_getLegendWidth","isSizeLegend","isValueLegend","right","lineWidth","font","ymin","ymax","_colormap","strokeStyle","beginPath","moveTo","lineTo","strokeRect","widthMin","fillStyle","closePath","legendMin","legendMax","from","to","_line","textAlign","textBaseline","fillText","label","info","lineStyle","text","armAngle","yMargin","point2d","offset","save","translate","rotate","restore","_line3d","from2d","to2d","xText","yText","zText","xOffset","yOffset","gridLenX","gridLenY","textMargin","armVector","defaultXStep","msg","defaultYStep","defaultZStep","from3d","xMin2d","xMax2d","_getStrokeWidth","_redrawBar","xWidth","yWidth","forEach","surfaces","corners","j","transCenter","_polygon","_drawCircle","size","radius","_calcRadius","arc","_getColorsRegular","_getColorsColor","pointStyle","_getColorsSize","r","g","maxIndex","startIndex","floor","endIndex","innerRatio","Number","colors","fraction","dotSize","sizeMin","cross","cosViewAngle","topSideVisible","aDiff","bDiff","surfaceNormal","surfacePosition","ratio","_drawGridLine","_storeMousePosition","startMouseX","startMouseY","_startCameraOffset","window","leftButtonDown","touchDown","startStart","startEnd","startArmRotation","moving","diffX","diffY","ctrlKey","scaleX","scaleY","offXNew","offYNew","horizontalNew","verticalNew","snapAngle","snapValue","parameters","emit","hasListeners","boundingRect","getBoundingClientRect","mouseX","mouseY","dataPoint","_dataPointFromXY","delay","tooltipTimeout","clearTimeout","_hideTooltip","_showTooltip","ontouchmove","_onTouchMove","ontouchend","_onTouchEnd","delta","wheelDelta","detail","newLength","_insideTriangle","triangle","as","bs","cs","closestDataPoint","closestDist","s","triangle1","triangle2","distX","distY","dom","assign","contentWidth","offsetWidth","contentHeight","lineHeight","dotWidth","dotHeight","elem","parentNode","setSize"],"mappings":"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"}